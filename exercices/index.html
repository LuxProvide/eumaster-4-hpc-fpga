
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Training course on how to use the IntelÂ® FPGA for Quantum Computing">
      
      
        <meta name="author" content="Emmanuel Kieffer">
      
      
        <link rel="canonical" href="https://gitlab.lxp.lu/emmanuel.kieffer/eumaster-4-hpc-fpga/exercices/">
      
      
        <link rel="prev" href="../optimization/">
      
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Hands-on session - Introduction to FPGA computing for the HPC ecosystem on Meluxina</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bcfcd587.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hands-on-session" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Introduction to FPGA computing for the HPC ecosystem on Meluxina" class="md-header__button md-logo" aria-label="Introduction to FPGA computing for the HPC ecosystem on Meluxina" data-md-component="logo">
      
  <img src="../assets/LuxProvide_logo_white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction to FPGA computing for the HPC ecosystem on Meluxina
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Hands-on session
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://gitlab.lxp.lu/emmanuel.kieffer/eumaster-4-hpc-fpga" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    emmanuel.kieffer/eumaster-4-hpc-fpga
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Introduction to FPGA computing for the HPC ecosystem on Meluxina" class="md-nav__button md-logo" aria-label="Introduction to FPGA computing for the HPC ecosystem on Meluxina" data-md-component="logo">
      
  <img src="../assets/LuxProvide_logo_white.svg" alt="logo">

    </a>
    Introduction to FPGA computing for the HPC ecosystem on Meluxina
  </label>
  
    <div class="md-nav__source">
      <a href="https://gitlab.lxp.lu/emmanuel.kieffer/eumaster-4-hpc-fpga" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    emmanuel.kieffer/eumaster-4-hpc-fpga
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Course description
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Lecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FPGA computing for the HPC ecosystem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dpcpp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SYCL & the IntelÂ® DPC++ compiler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compiling SYCL programs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developing SYCL programs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reporting_profiling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reporting & Profiling SYCL programs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../optimization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimizing SYCL programs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Hands-on session
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Hands-on session
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#access-to-meluxina" class="md-nav__link">
    <span class="md-ellipsis">
      Access to MeluXina
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercices" class="md-nav__link">
    <span class="md-ellipsis">
      Exercices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#e01-first-compilation" class="md-nav__link">
    <span class="md-ellipsis">
      E01-first-compilation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e02-enqueue-kernel" class="md-nav__link">
    <span class="md-ellipsis">
      E02-enqueue-kernel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e03-transfer-data" class="md-nav__link">
    <span class="md-ellipsis">
      E03-transfer-data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e04-buffer-transfer" class="md-nav__link">
    <span class="md-ellipsis">
      E04-buffer-transfer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e05-dot-product" class="md-nav__link">
    <span class="md-ellipsis">
      E05-dot-product
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e06-mat-transpose" class="md-nav__link">
    <span class="md-ellipsis">
      E06-mat-transpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e07-shared-memory" class="md-nav__link">
    <span class="md-ellipsis">
      E07-shared-memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e08-pipe" class="md-nav__link">
    <span class="md-ellipsis">
      E08-pipe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e09-multi-device" class="md-nav__link">
    <span class="md-ellipsis">
      E09-multi-device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e10-convolution" class="md-nav__link">
    <span class="md-ellipsis">
      E10-convolution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#access-to-meluxina" class="md-nav__link">
    <span class="md-ellipsis">
      Access to MeluXina
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercices" class="md-nav__link">
    <span class="md-ellipsis">
      Exercices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#e01-first-compilation" class="md-nav__link">
    <span class="md-ellipsis">
      E01-first-compilation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e02-enqueue-kernel" class="md-nav__link">
    <span class="md-ellipsis">
      E02-enqueue-kernel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e03-transfer-data" class="md-nav__link">
    <span class="md-ellipsis">
      E03-transfer-data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e04-buffer-transfer" class="md-nav__link">
    <span class="md-ellipsis">
      E04-buffer-transfer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e05-dot-product" class="md-nav__link">
    <span class="md-ellipsis">
      E05-dot-product
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e06-mat-transpose" class="md-nav__link">
    <span class="md-ellipsis">
      E06-mat-transpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e07-shared-memory" class="md-nav__link">
    <span class="md-ellipsis">
      E07-shared-memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e08-pipe" class="md-nav__link">
    <span class="md-ellipsis">
      E08-pipe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e09-multi-device" class="md-nav__link">
    <span class="md-ellipsis">
      E09-multi-device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e10-convolution" class="md-nav__link">
    <span class="md-ellipsis">
      E10-convolution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                



                  


<h1 id="hands-on-session">Hands-on session<a class="headerlink" href="#hands-on-session" title="Permanent link">&para;</a></h1>
<ul>
<li>
<p>This hands-on session is designed to provide you with practical, interactive experience. It allows you to apply theoretical knowledge directly by working with real tools or code, thereby deepening your understanding, building practical skills, and boosting confidence in the subject matter.</p>
</li>
<li>
<p>Using the resources seen this morning, i.e.,</p>
<ul>
<li><a href="../compile/">Compiling SYCL programs</a></li>
<li><a href="../writing/">Developing SYCL programs</a></li>
<li><a href="../writing/">Reporting &amp; Profiling SYCL programs</a></li>
<li><a href="../optimization/">Optimizing SYCL programs</a>  </li>
</ul>
</li>
</ul>
<h2 id="access-to-meluxina">Access to MeluXina<a class="headerlink" href="#access-to-meluxina" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>This workshop <strong>IS NOT</strong> a session on how to connect to MeluXina</p>
</li>
<li>
<p>You <strong>SHOULD ALL</strong> have access to MeluXina before starting the workshop </p>
</li>
<li>
<p>Please note that if you did not register in time, we <strong>WILL NOT</strong> onboard you during the workshop</p>
</li>
<li>
<p>You <strong>SHOULD</strong> all have received a Welcome Email providing all the necessary guidelines to connect MeluXina</p>
</li>
<li>
<p>If you did not setup your connection to MeluXina in time, please follow the <a href="https://docs.lxp.lu/first-steps/connecting/">documentation</a> or contact the <a href="https://servicedesk.lxp.lu/">service desk</a></p>
</li>
</ul>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<ul>
<li>You need first to obtain an interactive job on the fpga partition and load a module
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>salloc<span class="w"> </span>-A<span class="w"> </span>&lt;ACCOUNT&gt;<span class="w"> </span>--reservation<span class="o">=</span>&lt;RESERVATION&gt;<span class="w"> </span>-t<span class="w"> </span><span class="m">00</span>:30:00<span class="w"> </span>-q<span class="w"> </span>short<span class="w"> </span>-p<span class="w"> </span>cpu<span class="w"> </span>-N1
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>module<span class="w"> </span>load<span class="w"> </span>git-lfs
</span></code></pre></div></li>
<li>Clone first the repository and enter the <code>exercices</code> folder
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>git<span class="w"> </span>lfs<span class="w"> </span>clone<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://gitlab.lxp.lu/emmanuel.kieffer/eumaster-4-hpc-fpga.git
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nb">cd</span><span class="w"> </span>eumaster-4-hpc-fpga.git/exercices
</span></code></pre></div></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Reservations</p>
<p>Please use only the two following reservations which have dedicated resources for this event:</p>
<ul>
<li>
<p><code>#SBATCH --reservation=eumaster4hpc-fpga</code> for accessing the 15 reserved FPGA nodes</p>
</li>
<li>
<p><code>#SBATCH --reservation=eumaster4hpc-cpu</code> for accessing the 30 reserved CPU nodes</p>
</li>
</ul>
<p>While emulation can be done using both reservations, FPGA image provided to you can only be executed using the <code>eumaster4hpc-fpga</code> reservation.</p>
</div>
<h2 id="exercices">Exercices<a class="headerlink" href="#exercices" title="Permanent link">&para;</a></h2>
<h3 id="e01-first-compilation">E01-first-compilation<a class="headerlink" href="#e01-first-compilation" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">First compilation</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><input id="__tabbed_1_4" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Instruction</label><label for="__tabbed_1_2">Code description</label><label for="__tabbed_1_3">Emulation (test + solution)</label><label for="__tabbed_1_4">Hardware (Solution)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Go to <code>./exercices/E01-first-compilation</code></li>
<li>Add the minimun required code in <code>src/01-first-compilation.cpp</code> to select the FPGA device and create a sycl queue</li>
<li>Execute your code with the FPGA emulator</li>
<li>Execute the FPGA image in the <code>fpga_image</code> folder</li>
</ul>
</div>
<div class="tabbed-block">
<div class="language-cpp highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span>
<span class="normal"><a href="#__codelineno-2-30">30</a></span>
<span class="normal"><a href="#__codelineno-2-31">31</a></span>
<span class="normal"><a href="#__codelineno-2-32">32</a></span>
<span class="normal"><a href="#__codelineno-2-33">33</a></span>
<span class="normal"><a href="#__codelineno-2-34">34</a></span>
<span class="normal"><a href="#__codelineno-2-35">35</a></span>
<span class="normal"><a href="#__codelineno-2-36">36</a></span>
<span class="normal"><a href="#__codelineno-2-37">37</a></span>
<span class="normal"><a href="#__codelineno-2-38">38</a></span>
<span class="normal"><a href="#__codelineno-2-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="c1">// oneAPI headers</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/ext/intel/fpga_extensions.hpp&gt;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/sycl.hpp&gt;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">  </span><span class="cm">/*</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="cm">   *</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="cm">   *</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="cm">   *  ADD YOUR CODE HERE</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="cm">   *</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="cm">   *</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="cm">   *</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="cm">   *</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="cm">   */</span><span class="w"> </span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Running on device: &quot;</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">device</span><span class="p">.</span><span class="n">get_info</span><span class="o">&lt;</span><span class="n">sycl</span><span class="o">::</span><span class="n">info</span><span class="o">::</span><span class="n">device</span><span class="o">::</span><span class="n">name</span><span class="o">&gt;</span><span class="p">().</span><span class="n">c_str</span><span class="p">()</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23"></a>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">sycl</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="w">    </span><span class="c1">// Catches exceptions in the host code.</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Caught a SYCL host exception:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27"></a>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="w">    </span><span class="c1">// Most likely the runtime couldn&#39;t find FPGA hardware!</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">().</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CL_DEVICE_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting an FPGA, please ensure that your &quot;</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="w">                   </span><span class="s">&quot;system has a correctly configured FPGA board.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Run sys_check in the oneAPI root directory to verify.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting the FPGA emulator, compile with &quot;</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34"></a><span class="w">                   </span><span class="s">&quot;-DFPGA_EMULATOR.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<ul>
<li>To execute your code, uncomment the following lines in <code>launcher_E01-first-compilation.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building&quot;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DBUILD<span class="o">=</span>EX<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>./E01-first-compilation.fpga_emu
</span></code></pre></div></li>
<li>To test the solution, uncomment the following lines in <code>launcher_E01-first-compilation.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DPASSWORD<span class="o">=</span><span class="s2">&quot;XXXXXX&quot;</span><span class="w"> </span>-DBUILD<span class="o">=</span>SOL<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>./E01-first-compilation.fpga_emu
</span></code></pre></div></li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>To run the fpga image, uncomment the following lines in <code>launcher_E01-first-compilation.sh</code></li>
<li>Make sure that the header <code>#SBATCH -p fpga</code> is present
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">JEMALLOC_PRELOAD</span><span class="o">=</span><span class="k">$(</span>jemalloc-config<span class="w"> </span>--libdir<span class="k">)</span>/libjemalloc.so.<span class="k">$(</span>jemalloc-config<span class="w"> </span>--revision<span class="k">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nb">cd</span><span class="w"> </span>fpga_image
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="si">${</span><span class="nv">JEMALLOC_PRELOAD</span><span class="si">}</span><span class="w"> </span>./E01-first-compilation.fpga
</span></code></pre></div></li>
</ul>
</div>
</div>
</div>
</div>
<h3 id="e02-enqueue-kernel">E02-enqueue-kernel<a class="headerlink" href="#e02-enqueue-kernel" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">Enqueuing a single task kernel</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:4"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><input id="__tabbed_2_3" name="__tabbed_2" type="radio" /><input id="__tabbed_2_4" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Instruction</label><label for="__tabbed_2_2">Code description</label><label for="__tabbed_2_3">Emulation (test + solution)</label><label for="__tabbed_2_4">Hardware (Solution)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Go to <code>./exercices/E02-enqueue-kernel</code></li>
<li>Add the minimun required code in <code>src/02-enqueue-kernel.cpp</code> to enqueue a single-task kernel. The body of the kernel should contain the following:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>PRINTF<span class="o">(</span><span class="s2">&quot;Result1: Hello, World!\n&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>PRINTF<span class="o">(</span><span class="s2">&quot;Result2: %%\n&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>PRINTF<span class="o">(</span><span class="s2">&quot;Result3: %d\n&quot;</span>,<span class="w"> </span>x<span class="o">)</span><span class="p">;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>PRINTF<span class="o">(</span><span class="s2">&quot;Result4: %u\n&quot;</span>,<span class="w"> </span><span class="m">123</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>PRINTF<span class="o">(</span><span class="s2">&quot;Result5: %.2f\n&quot;</span>,<span class="w"> </span>y<span class="o">)</span><span class="p">;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>PRINTF<span class="o">(</span><span class="s2">&quot;Result6: print slash_n \\n \n&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>PRINTF<span class="o">(</span><span class="s2">&quot;Result7: Long: %ld\n&quot;</span>,<span class="w"> </span>650000L<span class="o">)</span><span class="p">;</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>PRINTF<span class="o">(</span><span class="s2">&quot;Result8: Preceding with blanks: %10d \n&quot;</span>,<span class="w"> </span><span class="m">1977</span><span class="o">)</span><span class="p">;</span><span class="w">                                                  </span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>PRINTF<span class="o">(</span><span class="s2">&quot;Result9: Preceding with zeros: %010d \n&quot;</span>,<span class="w"> </span><span class="m">1977</span><span class="o">)</span><span class="p">;</span><span class="w">                                                  </span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>PRINTF<span class="o">(</span><span class="s2">&quot;Result10: Some different radices: %d %x %o %#x %#o \n&quot;</span>,<span class="w"> </span><span class="m">100</span>,<span class="w">                                      </span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">       </span><span class="m">100</span>,<span class="w"> </span><span class="m">100</span>,<span class="w"> </span><span class="m">100</span>,<span class="w"> </span><span class="m">100</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>PRINTF<span class="o">(</span><span class="s2">&quot;Result11: ABC%c\n&quot;</span>,<span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="o">)</span><span class="p">;</span>
</span></code></pre></div></li>
<li>Execute your code with the FPGA emulator</li>
<li>Execute the FPGA image in the <code>fpga_image</code> folder</li>
</ul>
</div>
<div class="tabbed-block">
<div class="language-cpp highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span>
<span class="normal"><a href="#__codelineno-7-33">33</a></span>
<span class="normal"><a href="#__codelineno-7-34">34</a></span>
<span class="normal"><a href="#__codelineno-7-35">35</a></span>
<span class="normal"><a href="#__codelineno-7-36">36</a></span>
<span class="normal"><a href="#__codelineno-7-37">37</a></span>
<span class="normal"><a href="#__codelineno-7-38">38</a></span>
<span class="normal"><a href="#__codelineno-7-39">39</a></span>
<span class="normal"><a href="#__codelineno-7-40">40</a></span>
<span class="normal"><a href="#__codelineno-7-41">41</a></span>
<span class="normal"><a href="#__codelineno-7-42">42</a></span>
<span class="normal"><a href="#__codelineno-7-43">43</a></span>
<span class="normal"><a href="#__codelineno-7-44">44</a></span>
<span class="normal"><a href="#__codelineno-7-45">45</a></span>
<span class="normal"><a href="#__codelineno-7-46">46</a></span>
<span class="normal"><a href="#__codelineno-7-47">47</a></span>
<span class="normal"><a href="#__codelineno-7-48">48</a></span>
<span class="normal"><a href="#__codelineno-7-49">49</a></span>
<span class="normal"><a href="#__codelineno-7-50">50</a></span>
<span class="normal"><a href="#__codelineno-7-51">51</a></span>
<span class="normal"><a href="#__codelineno-7-52">52</a></span>
<span class="normal"><a href="#__codelineno-7-53">53</a></span>
<span class="normal"><a href="#__codelineno-7-54">54</a></span>
<span class="normal"><a href="#__codelineno-7-55">55</a></span>
<span class="normal"><a href="#__codelineno-7-56">56</a></span>
<span class="normal"><a href="#__codelineno-7-57">57</a></span>
<span class="normal"><a href="#__codelineno-7-58">58</a></span>
<span class="normal"><a href="#__codelineno-7-59">59</a></span>
<span class="normal"><a href="#__codelineno-7-60">60</a></span>
<span class="normal"><a href="#__codelineno-7-61">61</a></span>
<span class="normal"><a href="#__codelineno-7-62">62</a></span>
<span class="normal"><a href="#__codelineno-7-63">63</a></span>
<span class="normal"><a href="#__codelineno-7-64">64</a></span>
<span class="normal"><a href="#__codelineno-7-65">65</a></span>
<span class="normal"><a href="#__codelineno-7-66">66</a></span>
<span class="normal"><a href="#__codelineno-7-67">67</a></span>
<span class="normal"><a href="#__codelineno-7-68">68</a></span>
<span class="normal"><a href="#__codelineno-7-69">69</a></span>
<span class="normal"><a href="#__codelineno-7-70">70</a></span>
<span class="normal"><a href="#__codelineno-7-71">71</a></span>
<span class="normal"><a href="#__codelineno-7-72">72</a></span>
<span class="normal"><a href="#__codelineno-7-73">73</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="c1">// oneAPI headers</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/ext/intel/fpga_extensions.hpp&gt;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/sycl.hpp&gt;</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="cp">#ifdef __SYCL_DEVICE_ONLY__</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="cp">#define CL_CONSTANT __attribute__((opencl_constant))</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="cp">#else</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="cp">#define CL_CONSTANT</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="cp">#endif</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">sycl</span><span class="p">;</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15"></a>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="cp">#define PRINTF(format, ...)                                    \</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="cp">  {                                                            \</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="cp">    static const CL_CONSTANT char _format[] = format;          \</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="cp">    ext::oneapi::experimental::printf(_format, ##__VA_ARGS__); \</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="cp">  }</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21"></a>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="k">class</span><span class="w"> </span><span class="nc">BasicKernel</span><span class="p">;</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23"></a>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="w">    </span><span class="c1">// Use compile-time macros to select either:</span>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="w">    </span><span class="c1">//  - the FPGA emulator device (CPU emulation of the FPGA)</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="w">    </span><span class="c1">//  - the FPGA device (a real FPGA)</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="w">    </span><span class="c1">//  - the simulator device</span>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31"></a><span class="w">      </span><span class="cp">#if FPGA_SIMULATOR</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_simulator_selector_v</span><span class="p">;</span>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33"></a><span class="w">      </span><span class="cp">#elif FPGA_HARDWARE</span>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_selector_v</span><span class="p">;</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35"></a><span class="w">      </span><span class="cp">#else  </span><span class="c1">// #if FPGA_EMULATOR</span>
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_emulator_selector_v</span><span class="p">;</span>
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37"></a><span class="w">      </span><span class="cp">#endif</span>
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38"></a>
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39"></a><span class="w">    </span><span class="c1">// create the device queue</span>
</span><span id="__span-7-40"><a id="__codelineno-7-40" name="__codelineno-7-40"></a><span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">queue</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="n">selector</span><span class="p">);</span>
</span><span id="__span-7-41"><a id="__codelineno-7-41" name="__codelineno-7-41"></a>
</span><span id="__span-7-42"><a id="__codelineno-7-42" name="__codelineno-7-42"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">get_device</span><span class="p">();</span>
</span><span id="__span-7-43"><a id="__codelineno-7-43" name="__codelineno-7-43"></a>
</span><span id="__span-7-44"><a id="__codelineno-7-44" name="__codelineno-7-44"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Running on device: &quot;</span>
</span><span id="__span-7-45"><a id="__codelineno-7-45" name="__codelineno-7-45"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">device</span><span class="p">.</span><span class="n">get_info</span><span class="o">&lt;</span><span class="n">sycl</span><span class="o">::</span><span class="n">info</span><span class="o">::</span><span class="n">device</span><span class="o">::</span><span class="n">name</span><span class="o">&gt;</span><span class="p">().</span><span class="n">c_str</span><span class="p">()</span>
</span><span id="__span-7-46"><a id="__codelineno-7-46" name="__codelineno-7-46"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-7-47"><a id="__codelineno-7-47" name="__codelineno-7-47"></a>
</span><span id="__span-7-48"><a id="__codelineno-7-48" name="__codelineno-7-48"></a><span class="w">    </span><span class="cm">/*</span>
</span><span id="__span-7-49"><a id="__codelineno-7-49" name="__codelineno-7-49"></a><span class="cm">    *</span>
</span><span id="__span-7-50"><a id="__codelineno-7-50" name="__codelineno-7-50"></a><span class="cm">    *   Enqueue kernel here</span>
</span><span id="__span-7-51"><a id="__codelineno-7-51" name="__codelineno-7-51"></a><span class="cm">    *</span>
</span><span id="__span-7-52"><a id="__codelineno-7-52" name="__codelineno-7-52"></a><span class="cm">    *</span>
</span><span id="__span-7-53"><a id="__codelineno-7-53" name="__codelineno-7-53"></a><span class="cm">    */</span>
</span><span id="__span-7-54"><a id="__codelineno-7-54" name="__codelineno-7-54"></a>
</span><span id="__span-7-55"><a id="__codelineno-7-55" name="__codelineno-7-55"></a>
</span><span id="__span-7-56"><a id="__codelineno-7-56" name="__codelineno-7-56"></a>
</span><span id="__span-7-57"><a id="__codelineno-7-57" name="__codelineno-7-57"></a>
</span><span id="__span-7-58"><a id="__codelineno-7-58" name="__codelineno-7-58"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">sycl</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-59"><a id="__codelineno-7-59" name="__codelineno-7-59"></a><span class="w">    </span><span class="c1">// Catches exceptions in the host code.</span>
</span><span id="__span-7-60"><a id="__codelineno-7-60" name="__codelineno-7-60"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Caught a SYCL host exception:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-7-61"><a id="__codelineno-7-61" name="__codelineno-7-61"></a>
</span><span id="__span-7-62"><a id="__codelineno-7-62" name="__codelineno-7-62"></a><span class="w">    </span><span class="c1">// Most likely the runtime couldn&#39;t find FPGA hardware!</span>
</span><span id="__span-7-63"><a id="__codelineno-7-63" name="__codelineno-7-63"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">().</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CL_DEVICE_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-64"><a id="__codelineno-7-64" name="__codelineno-7-64"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting an FPGA, please ensure that your &quot;</span>
</span><span id="__span-7-65"><a id="__codelineno-7-65" name="__codelineno-7-65"></a><span class="w">                   </span><span class="s">&quot;system has a correctly configured FPGA board.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-7-66"><a id="__codelineno-7-66" name="__codelineno-7-66"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Run sys_check in the oneAPI root directory to verify.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-7-67"><a id="__codelineno-7-67" name="__codelineno-7-67"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting the FPGA emulator, compile with &quot;</span>
</span><span id="__span-7-68"><a id="__codelineno-7-68" name="__codelineno-7-68"></a><span class="w">                   </span><span class="s">&quot;-DFPGA_EMULATOR.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-7-69"><a id="__codelineno-7-69" name="__codelineno-7-69"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-7-70"><a id="__codelineno-7-70" name="__codelineno-7-70"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
</span><span id="__span-7-71"><a id="__codelineno-7-71" name="__codelineno-7-71"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-7-72"><a id="__codelineno-7-72" name="__codelineno-7-72"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
</span><span id="__span-7-73"><a id="__codelineno-7-73" name="__codelineno-7-73"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<ul>
<li>To execute your code, uncomment the following lines in <code>launcher_E02-enqueue-kernel.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building&quot;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DBUILD<span class="o">=</span>EX<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>./E02-enqueue-kernel.fpga_emu
</span></code></pre></div></li>
<li>To test the solution, uncomment the following lines in <code>launcher_E02-enqueue-kernel.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DPASSWORD<span class="o">=</span><span class="s2">&quot;XXXXXX&quot;</span><span class="w"> </span>-DBUILD<span class="o">=</span>SOL<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>./E02-enqueue-kernel.fpga_emu
</span></code></pre></div></li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>To run the fpga image, uncomment the following lines in <code>launcher_E02-enqueue-kernel.sh</code></li>
<li>Make sure that the header <code>#SBATCH -p fpga</code> is present
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">JEMALLOC_PRELOAD</span><span class="o">=</span><span class="k">$(</span>jemalloc-config<span class="w"> </span>--libdir<span class="k">)</span>/libjemalloc.so.<span class="k">$(</span>jemalloc-config<span class="w"> </span>--revision<span class="k">)</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nb">cd</span><span class="w"> </span>fpga_image
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="si">${</span><span class="nv">JEMALLOC_PRELOAD</span><span class="si">}</span><span class="w"> </span>./E02-enqueue-kernel.fpga
</span></code></pre></div></li>
</ul>
</div>
</div>
</div>
</div>
<h3 id="e03-transfer-data">E03-transfer-data<a class="headerlink" href="#e03-transfer-data" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">Transferring data to the device</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:4"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><input id="__tabbed_3_3" name="__tabbed_3" type="radio" /><input id="__tabbed_3_4" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Instruction</label><label for="__tabbed_3_2">Code description</label><label for="__tabbed_3_3">Emulation (test + solution)</label><label for="__tabbed_3_4">Hardware (Solution)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Go to <code>./exercices/E03-transfer-data</code></li>
<li>Transfer the data from <code>host_vec_a</code> and <code>host_vec_b</code> to the device by using the <code>memcpy</code> function</li>
<li>Execute your code with the FPGA emulator</li>
<li>Execute the FPGA image in the <code>fpga_image</code> folder</li>
</ul>
</div>
<div class="tabbed-block">
<div class="language-cpp highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span>
<span class="normal"><a href="#__codelineno-11-21">21</a></span>
<span class="normal"><a href="#__codelineno-11-22">22</a></span>
<span class="normal"><a href="#__codelineno-11-23">23</a></span>
<span class="normal"><a href="#__codelineno-11-24">24</a></span>
<span class="normal"><a href="#__codelineno-11-25">25</a></span>
<span class="normal"><a href="#__codelineno-11-26">26</a></span>
<span class="normal"><a href="#__codelineno-11-27">27</a></span>
<span class="normal"><a href="#__codelineno-11-28">28</a></span>
<span class="normal"><a href="#__codelineno-11-29">29</a></span>
<span class="normal"><a href="#__codelineno-11-30">30</a></span>
<span class="normal"><a href="#__codelineno-11-31">31</a></span>
<span class="normal"><a href="#__codelineno-11-32">32</a></span>
<span class="normal"><a href="#__codelineno-11-33">33</a></span>
<span class="normal"><a href="#__codelineno-11-34">34</a></span>
<span class="normal"><a href="#__codelineno-11-35">35</a></span>
<span class="normal"><a href="#__codelineno-11-36">36</a></span>
<span class="normal"><a href="#__codelineno-11-37">37</a></span>
<span class="normal"><a href="#__codelineno-11-38">38</a></span>
<span class="normal"><a href="#__codelineno-11-39">39</a></span>
<span class="normal"><a href="#__codelineno-11-40">40</a></span>
<span class="normal"><a href="#__codelineno-11-41">41</a></span>
<span class="normal"><a href="#__codelineno-11-42">42</a></span>
<span class="normal"><a href="#__codelineno-11-43">43</a></span>
<span class="normal"><a href="#__codelineno-11-44">44</a></span>
<span class="normal"><a href="#__codelineno-11-45">45</a></span>
<span class="normal"><a href="#__codelineno-11-46">46</a></span>
<span class="normal"><a href="#__codelineno-11-47">47</a></span>
<span class="normal"><a href="#__codelineno-11-48">48</a></span>
<span class="normal"><a href="#__codelineno-11-49">49</a></span>
<span class="normal"><a href="#__codelineno-11-50">50</a></span>
<span class="normal"><a href="#__codelineno-11-51">51</a></span>
<span class="normal"><a href="#__codelineno-11-52">52</a></span>
<span class="normal"><a href="#__codelineno-11-53">53</a></span>
<span class="normal"><a href="#__codelineno-11-54">54</a></span>
<span class="normal"><a href="#__codelineno-11-55">55</a></span>
<span class="normal"><a href="#__codelineno-11-56">56</a></span>
<span class="normal"><a href="#__codelineno-11-57">57</a></span>
<span class="normal"><a href="#__codelineno-11-58">58</a></span>
<span class="normal"><a href="#__codelineno-11-59">59</a></span>
<span class="normal"><a href="#__codelineno-11-60">60</a></span>
<span class="normal"><a href="#__codelineno-11-61">61</a></span>
<span class="normal"><a href="#__codelineno-11-62">62</a></span>
<span class="normal"><a href="#__codelineno-11-63">63</a></span>
<span class="normal"><a href="#__codelineno-11-64">64</a></span>
<span class="normal"><a href="#__codelineno-11-65">65</a></span>
<span class="normal"><a href="#__codelineno-11-66">66</a></span>
<span class="normal"><a href="#__codelineno-11-67">67</a></span>
<span class="normal"><a href="#__codelineno-11-68">68</a></span>
<span class="normal"><a href="#__codelineno-11-69">69</a></span>
<span class="normal"><a href="#__codelineno-11-70">70</a></span>
<span class="normal"><a href="#__codelineno-11-71">71</a></span>
<span class="normal"><a href="#__codelineno-11-72">72</a></span>
<span class="normal"><a href="#__codelineno-11-73">73</a></span>
<span class="normal"><a href="#__codelineno-11-74">74</a></span>
<span class="normal"><a href="#__codelineno-11-75">75</a></span>
<span class="normal"><a href="#__codelineno-11-76">76</a></span>
<span class="normal"><a href="#__codelineno-11-77">77</a></span>
<span class="normal"><a href="#__codelineno-11-78">78</a></span>
<span class="normal"><a href="#__codelineno-11-79">79</a></span>
<span class="normal"><a href="#__codelineno-11-80">80</a></span>
<span class="normal"><a href="#__codelineno-11-81">81</a></span>
<span class="normal"><a href="#__codelineno-11-82">82</a></span>
<span class="normal"><a href="#__codelineno-11-83">83</a></span>
<span class="normal"><a href="#__codelineno-11-84">84</a></span>
<span class="normal"><a href="#__codelineno-11-85">85</a></span>
<span class="normal"><a href="#__codelineno-11-86">86</a></span>
<span class="normal"><a href="#__codelineno-11-87">87</a></span>
<span class="normal"><a href="#__codelineno-11-88">88</a></span>
<span class="normal"><a href="#__codelineno-11-89">89</a></span>
<span class="normal"><a href="#__codelineno-11-90">90</a></span>
<span class="normal"><a href="#__codelineno-11-91">91</a></span>
<span class="normal"><a href="#__codelineno-11-92">92</a></span>
<span class="normal"><a href="#__codelineno-11-93">93</a></span>
<span class="normal"><a href="#__codelineno-11-94">94</a></span>
<span class="normal"><a href="#__codelineno-11-95">95</a></span>
<span class="normal"><a href="#__codelineno-11-96">96</a></span>
<span class="normal"><a href="#__codelineno-11-97">97</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="c1">// oneAPI headers</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/ext/intel/fpga_extensions.hpp&gt;</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/sycl.hpp&gt;</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="cp">#ifdef __SYCL_DEVICE_ONLY__</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="cp">#define CL_CONSTANT __attribute__((opencl_constant))</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="cp">#else</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="cp">#define CL_CONSTANT</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="cp">#endif</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13"></a>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">sycl</span><span class="p">;</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15"></a>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="cp">#define PRINTF(format, ...)                                    \</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="cp">  {                                                            \</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="cp">    static const CL_CONSTANT char _format[] = format;          \</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19"></a><span class="cp">    ext::oneapi::experimental::printf(_format, ##__VA_ARGS__); \</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20"></a><span class="cp">  }</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21"></a>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22"></a><span class="k">class</span><span class="w"> </span><span class="nc">BasicKernel</span><span class="p">;</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23"></a>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24"></a>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">kVectSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29"></a><span class="w">    </span><span class="c1">// Use compile-time macros to select either:</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30"></a><span class="w">    </span><span class="c1">//  - the FPGA emulator device (CPU emulation of the FPGA)</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31"></a><span class="w">    </span><span class="c1">//  - the FPGA device (a real FPGA)</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32"></a><span class="w">    </span><span class="c1">//  - the simulator device</span>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33"></a><span class="w">      </span><span class="cp">#if FPGA_SIMULATOR</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_simulator_selector_v</span><span class="p">;</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35"></a><span class="w">      </span><span class="cp">#elif FPGA_HARDWARE</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_selector_v</span><span class="p">;</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37"></a><span class="w">      </span><span class="cp">#else  </span><span class="c1">// #if FPGA_EMULATOR</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_emulator_selector_v</span><span class="p">;</span>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39"></a><span class="w">      </span><span class="cp">#endif</span>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40"></a>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41"></a><span class="w">    </span><span class="c1">// create the device queue</span>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42"></a><span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">queue</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="n">selector</span><span class="p">);</span>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43"></a>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">get_device</span><span class="p">();</span>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45"></a>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Running on device: &quot;</span>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">device</span><span class="p">.</span><span class="n">get_info</span><span class="o">&lt;</span><span class="n">sycl</span><span class="o">::</span><span class="n">info</span><span class="o">::</span><span class="n">device</span><span class="o">::</span><span class="n">name</span><span class="o">&gt;</span><span class="p">().</span><span class="n">c_str</span><span class="p">()</span>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49"></a>
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">host_vec_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">kVectSize</span><span class="p">];</span>
</span><span id="__span-11-51"><a id="__codelineno-11-51" name="__codelineno-11-51"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">host_vec_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">kVectSize</span><span class="p">];</span>
</span><span id="__span-11-52"><a id="__codelineno-11-52" name="__codelineno-11-52"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc_device</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kVectSize</span><span class="p">,</span><span class="n">q</span><span class="p">);</span>
</span><span id="__span-11-53"><a id="__codelineno-11-53" name="__codelineno-11-53"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc_device</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kVectSize</span><span class="p">,</span><span class="n">q</span><span class="p">);</span>
</span><span id="__span-11-54"><a id="__codelineno-11-54" name="__codelineno-11-54"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc_device</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kVectSize</span><span class="p">,</span><span class="n">q</span><span class="p">);</span>
</span><span id="__span-11-55"><a id="__codelineno-11-55" name="__codelineno-11-55"></a>
</span><span id="__span-11-56"><a id="__codelineno-11-56" name="__codelineno-11-56"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">kVectSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-57"><a id="__codelineno-11-57" name="__codelineno-11-57"></a><span class="w">      </span><span class="n">host_vec_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-11-58"><a id="__codelineno-11-58" name="__codelineno-11-58"></a><span class="w">      </span><span class="n">host_vec_b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">kVectSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-11-59"><a id="__codelineno-11-59" name="__codelineno-11-59"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-60"><a id="__codelineno-11-60" name="__codelineno-11-60"></a>
</span><span id="__span-11-61"><a id="__codelineno-11-61" name="__codelineno-11-61"></a><span class="w">    </span><span class="cm">/*</span>
</span><span id="__span-11-62"><a id="__codelineno-11-62" name="__codelineno-11-62"></a><span class="cm">      * Transfer host_vec_a to vec_a on the device</span>
</span><span id="__span-11-63"><a id="__codelineno-11-63" name="__codelineno-11-63"></a><span class="cm">      * Transfer host_vec_b to vec_b on the device</span>
</span><span id="__span-11-64"><a id="__codelineno-11-64" name="__codelineno-11-64"></a><span class="cm">      *</span>
</span><span id="__span-11-65"><a id="__codelineno-11-65" name="__codelineno-11-65"></a><span class="cm">      */</span>
</span><span id="__span-11-66"><a id="__codelineno-11-66" name="__codelineno-11-66"></a>
</span><span id="__span-11-67"><a id="__codelineno-11-67" name="__codelineno-11-67"></a><span class="w">    </span><span class="n">q</span><span class="p">.</span><span class="n">submit</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">handler</span><span class="o">&amp;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-68"><a id="__codelineno-11-68" name="__codelineno-11-68"></a><span class="w">      </span><span class="n">h</span><span class="p">.</span><span class="n">single_task</span><span class="o">&lt;</span><span class="n">BasicKernel</span><span class="o">&gt;</span><span class="p">([</span><span class="o">=</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-69"><a id="__codelineno-11-69" name="__codelineno-11-69"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">kVectSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-11-70"><a id="__codelineno-11-70" name="__codelineno-11-70"></a><span class="w">          </span><span class="n">PRINTF</span><span class="p">(</span><span class="s">&quot;vect_a[%d]: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">vec_a</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-11-71"><a id="__codelineno-11-71" name="__codelineno-11-71"></a><span class="w">          </span><span class="n">PRINTF</span><span class="p">(</span><span class="s">&quot;vect_b[%d]: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">vec_b</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-11-72"><a id="__codelineno-11-72" name="__codelineno-11-72"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-11-73"><a id="__codelineno-11-73" name="__codelineno-11-73"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-11-74"><a id="__codelineno-11-74" name="__codelineno-11-74"></a><span class="w">    </span><span class="p">}).</span><span class="n">wait</span><span class="p">();</span>
</span><span id="__span-11-75"><a id="__codelineno-11-75" name="__codelineno-11-75"></a>
</span><span id="__span-11-76"><a id="__codelineno-11-76" name="__codelineno-11-76"></a><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">host_vec_a</span><span class="p">;</span>
</span><span id="__span-11-77"><a id="__codelineno-11-77" name="__codelineno-11-77"></a><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">host_vec_b</span><span class="p">;</span>
</span><span id="__span-11-78"><a id="__codelineno-11-78" name="__codelineno-11-78"></a><span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">free</span><span class="p">(</span><span class="n">vec_a</span><span class="p">,</span><span class="n">q</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-11-79"><a id="__codelineno-11-79" name="__codelineno-11-79"></a><span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">free</span><span class="p">(</span><span class="n">vec_b</span><span class="p">,</span><span class="n">q</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-11-80"><a id="__codelineno-11-80" name="__codelineno-11-80"></a><span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">free</span><span class="p">(</span><span class="n">vec_c</span><span class="p">,</span><span class="n">q</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-11-81"><a id="__codelineno-11-81" name="__codelineno-11-81"></a>
</span><span id="__span-11-82"><a id="__codelineno-11-82" name="__codelineno-11-82"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">sycl</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-83"><a id="__codelineno-11-83" name="__codelineno-11-83"></a><span class="w">    </span><span class="c1">// Catches exceptions in the host code.</span>
</span><span id="__span-11-84"><a id="__codelineno-11-84" name="__codelineno-11-84"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Caught a SYCL host exception:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-11-85"><a id="__codelineno-11-85" name="__codelineno-11-85"></a>
</span><span id="__span-11-86"><a id="__codelineno-11-86" name="__codelineno-11-86"></a><span class="w">    </span><span class="c1">// Most likely the runtime couldn&#39;t find FPGA hardware!</span>
</span><span id="__span-11-87"><a id="__codelineno-11-87" name="__codelineno-11-87"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">().</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CL_DEVICE_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-88"><a id="__codelineno-11-88" name="__codelineno-11-88"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting an FPGA, please ensure that your &quot;</span>
</span><span id="__span-11-89"><a id="__codelineno-11-89" name="__codelineno-11-89"></a><span class="w">                   </span><span class="s">&quot;system has a correctly configured FPGA board.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-11-90"><a id="__codelineno-11-90" name="__codelineno-11-90"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Run sys_check in the oneAPI root directory to verify.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-11-91"><a id="__codelineno-11-91" name="__codelineno-11-91"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting the FPGA emulator, compile with &quot;</span>
</span><span id="__span-11-92"><a id="__codelineno-11-92" name="__codelineno-11-92"></a><span class="w">                   </span><span class="s">&quot;-DFPGA_EMULATOR.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-11-93"><a id="__codelineno-11-93" name="__codelineno-11-93"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-94"><a id="__codelineno-11-94" name="__codelineno-11-94"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
</span><span id="__span-11-95"><a id="__codelineno-11-95" name="__codelineno-11-95"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-96"><a id="__codelineno-11-96" name="__codelineno-11-96"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
</span><span id="__span-11-97"><a id="__codelineno-11-97" name="__codelineno-11-97"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<ul>
<li>To execute your code, uncomment the following lines in <code>launcher_E03-transfer-data.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building&quot;</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DBUILD<span class="o">=</span>EX<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>./E03-transfer-data.fpga_emu
</span></code></pre></div></li>
<li>To test the solution, uncomment the following lines in <code>launcher_E03-transfer-data.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DPASSWORD<span class="o">=</span><span class="s2">&quot;XXXXXX&quot;</span><span class="w"> </span>-DBUILD<span class="o">=</span>SOL<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>./E03-transfer-data.fpga_emu
</span></code></pre></div></li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>To run the fpga image, uncomment the following lines in <code>launcher_E03-transfer-data.sh</code></li>
<li>Make sure that the header <code>#SBATCH -p fpga</code> is present
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">JEMALLOC_PRELOAD</span><span class="o">=</span><span class="k">$(</span>jemalloc-config<span class="w"> </span>--libdir<span class="k">)</span>/libjemalloc.so.<span class="k">$(</span>jemalloc-config<span class="w"> </span>--revision<span class="k">)</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="nb">cd</span><span class="w"> </span>fpga_image
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="si">${</span><span class="nv">JEMALLOC_PRELOAD</span><span class="si">}</span><span class="w"> </span>./E03-transfer-data.fpga
</span></code></pre></div></li>
</ul>
</div>
</div>
</div>
</div>
<h3 id="e04-buffer-transfer">E04-buffer-transfer<a class="headerlink" href="#e04-buffer-transfer" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">Using buffers to transfer data to kernels</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:4"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><input id="__tabbed_4_3" name="__tabbed_4" type="radio" /><input id="__tabbed_4_4" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Instruction</label><label for="__tabbed_4_2">Code description</label><label for="__tabbed_4_3">Emulation (test + solution)</label><label for="__tabbed_4_4">Hardware (Solution)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Go to <code>./exercices/E04-buffer-transfer</code></li>
<li>Create the buffers and accessors for the two host array <code>host_vec_a</code> and <code>host_vec_b</code></li>
<li>Execute your code with the FPGA emulator</li>
<li>Execute the FPGA image in the <code>fpga_image</code> folder</li>
</ul>
</div>
<div class="tabbed-block">
<div class="language-cpp highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span>
<span class="normal"><a href="#__codelineno-15-29">29</a></span>
<span class="normal"><a href="#__codelineno-15-30">30</a></span>
<span class="normal"><a href="#__codelineno-15-31">31</a></span>
<span class="normal"><a href="#__codelineno-15-32">32</a></span>
<span class="normal"><a href="#__codelineno-15-33">33</a></span>
<span class="normal"><a href="#__codelineno-15-34">34</a></span>
<span class="normal"><a href="#__codelineno-15-35">35</a></span>
<span class="normal"><a href="#__codelineno-15-36">36</a></span>
<span class="normal"><a href="#__codelineno-15-37">37</a></span>
<span class="normal"><a href="#__codelineno-15-38">38</a></span>
<span class="normal"><a href="#__codelineno-15-39">39</a></span>
<span class="normal"><a href="#__codelineno-15-40">40</a></span>
<span class="normal"><a href="#__codelineno-15-41">41</a></span>
<span class="normal"><a href="#__codelineno-15-42">42</a></span>
<span class="normal"><a href="#__codelineno-15-43">43</a></span>
<span class="normal"><a href="#__codelineno-15-44">44</a></span>
<span class="normal"><a href="#__codelineno-15-45">45</a></span>
<span class="normal"><a href="#__codelineno-15-46">46</a></span>
<span class="normal"><a href="#__codelineno-15-47">47</a></span>
<span class="normal"><a href="#__codelineno-15-48">48</a></span>
<span class="normal"><a href="#__codelineno-15-49">49</a></span>
<span class="normal"><a href="#__codelineno-15-50">50</a></span>
<span class="normal"><a href="#__codelineno-15-51">51</a></span>
<span class="normal"><a href="#__codelineno-15-52">52</a></span>
<span class="normal"><a href="#__codelineno-15-53">53</a></span>
<span class="normal"><a href="#__codelineno-15-54">54</a></span>
<span class="normal"><a href="#__codelineno-15-55">55</a></span>
<span class="normal"><a href="#__codelineno-15-56">56</a></span>
<span class="normal"><a href="#__codelineno-15-57">57</a></span>
<span class="normal"><a href="#__codelineno-15-58">58</a></span>
<span class="normal"><a href="#__codelineno-15-59">59</a></span>
<span class="normal"><a href="#__codelineno-15-60">60</a></span>
<span class="normal"><a href="#__codelineno-15-61">61</a></span>
<span class="normal"><a href="#__codelineno-15-62">62</a></span>
<span class="normal"><a href="#__codelineno-15-63">63</a></span>
<span class="normal"><a href="#__codelineno-15-64">64</a></span>
<span class="normal"><a href="#__codelineno-15-65">65</a></span>
<span class="normal"><a href="#__codelineno-15-66">66</a></span>
<span class="normal"><a href="#__codelineno-15-67">67</a></span>
<span class="normal"><a href="#__codelineno-15-68">68</a></span>
<span class="normal"><a href="#__codelineno-15-69">69</a></span>
<span class="normal"><a href="#__codelineno-15-70">70</a></span>
<span class="normal"><a href="#__codelineno-15-71">71</a></span>
<span class="normal"><a href="#__codelineno-15-72">72</a></span>
<span class="normal"><a href="#__codelineno-15-73">73</a></span>
<span class="normal"><a href="#__codelineno-15-74">74</a></span>
<span class="normal"><a href="#__codelineno-15-75">75</a></span>
<span class="normal"><a href="#__codelineno-15-76">76</a></span>
<span class="normal"><a href="#__codelineno-15-77">77</a></span>
<span class="normal"><a href="#__codelineno-15-78">78</a></span>
<span class="normal"><a href="#__codelineno-15-79">79</a></span>
<span class="normal"><a href="#__codelineno-15-80">80</a></span>
<span class="normal"><a href="#__codelineno-15-81">81</a></span>
<span class="normal"><a href="#__codelineno-15-82">82</a></span>
<span class="normal"><a href="#__codelineno-15-83">83</a></span>
<span class="normal"><a href="#__codelineno-15-84">84</a></span>
<span class="normal"><a href="#__codelineno-15-85">85</a></span>
<span class="normal"><a href="#__codelineno-15-86">86</a></span>
<span class="normal"><a href="#__codelineno-15-87">87</a></span>
<span class="normal"><a href="#__codelineno-15-88">88</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="c1">// oneAPI headers</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/ext/intel/fpga_extensions.hpp&gt;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/sycl.hpp&gt;</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7"></a>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="cp">#ifdef __SYCL_DEVICE_ONLY__</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="cp">#define CL_CONSTANT __attribute__((opencl_constant))</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="cp">#else</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="cp">#define CL_CONSTANT</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="cp">#endif</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13"></a>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">sycl</span><span class="p">;</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15"></a>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="cp">#define PRINTF(format, ...)                                    \</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="cp">  {                                                            \</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="cp">    static const CL_CONSTANT char _format[] = format;          \</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="cp">    ext::oneapi::experimental::printf(_format, ##__VA_ARGS__); \</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="cp">  }</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21"></a>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="k">class</span><span class="w"> </span><span class="nc">BasicKernel</span><span class="p">;</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23"></a>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24"></a>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">kVectSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29"></a><span class="w">    </span><span class="c1">// Use compile-time macros to select either:</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30"></a><span class="w">    </span><span class="c1">//  - the FPGA emulator device (CPU emulation of the FPGA)</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31"></a><span class="w">    </span><span class="c1">//  - the FPGA device (a real FPGA)</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32"></a><span class="w">    </span><span class="c1">//  - the simulator device</span>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33"></a><span class="w">      </span><span class="cp">#if FPGA_SIMULATOR</span>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_simulator_selector_v</span><span class="p">;</span>
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35"></a><span class="w">      </span><span class="cp">#elif FPGA_HARDWARE</span>
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_selector_v</span><span class="p">;</span>
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37"></a><span class="w">      </span><span class="cp">#else  </span><span class="c1">// #if FPGA_EMULATOR</span>
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_emulator_selector_v</span><span class="p">;</span>
</span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39"></a><span class="w">      </span><span class="cp">#endif</span>
</span><span id="__span-15-40"><a id="__codelineno-15-40" name="__codelineno-15-40"></a>
</span><span id="__span-15-41"><a id="__codelineno-15-41" name="__codelineno-15-41"></a><span class="w">    </span><span class="c1">// create the device queue</span>
</span><span id="__span-15-42"><a id="__codelineno-15-42" name="__codelineno-15-42"></a><span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">queue</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="n">selector</span><span class="p">);</span>
</span><span id="__span-15-43"><a id="__codelineno-15-43" name="__codelineno-15-43"></a>
</span><span id="__span-15-44"><a id="__codelineno-15-44" name="__codelineno-15-44"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">get_device</span><span class="p">();</span>
</span><span id="__span-15-45"><a id="__codelineno-15-45" name="__codelineno-15-45"></a>
</span><span id="__span-15-46"><a id="__codelineno-15-46" name="__codelineno-15-46"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Running on device: &quot;</span>
</span><span id="__span-15-47"><a id="__codelineno-15-47" name="__codelineno-15-47"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">device</span><span class="p">.</span><span class="n">get_info</span><span class="o">&lt;</span><span class="n">sycl</span><span class="o">::</span><span class="n">info</span><span class="o">::</span><span class="n">device</span><span class="o">::</span><span class="n">name</span><span class="o">&gt;</span><span class="p">().</span><span class="n">c_str</span><span class="p">()</span>
</span><span id="__span-15-48"><a id="__codelineno-15-48" name="__codelineno-15-48"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-15-49"><a id="__codelineno-15-49" name="__codelineno-15-49"></a>
</span><span id="__span-15-50"><a id="__codelineno-15-50" name="__codelineno-15-50"></a>
</span><span id="__span-15-51"><a id="__codelineno-15-51" name="__codelineno-15-51"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">host_vec_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">kVectSize</span><span class="p">];</span>
</span><span id="__span-15-52"><a id="__codelineno-15-52" name="__codelineno-15-52"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">host_vec_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">kVectSize</span><span class="p">];</span>
</span><span id="__span-15-53"><a id="__codelineno-15-53" name="__codelineno-15-53"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">kVectSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-54"><a id="__codelineno-15-54" name="__codelineno-15-54"></a><span class="w">      </span><span class="n">host_vec_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-15-55"><a id="__codelineno-15-55" name="__codelineno-15-55"></a><span class="w">      </span><span class="n">host_vec_b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">kVectSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-15-56"><a id="__codelineno-15-56" name="__codelineno-15-56"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-57"><a id="__codelineno-15-57" name="__codelineno-15-57"></a>
</span><span id="__span-15-58"><a id="__codelineno-15-58" name="__codelineno-15-58"></a>
</span><span id="__span-15-59"><a id="__codelineno-15-59" name="__codelineno-15-59"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Using buffer version&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-15-60"><a id="__codelineno-15-60" name="__codelineno-15-60"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-15-61"><a id="__codelineno-15-61" name="__codelineno-15-61"></a><span class="w">   </span><span class="cm">/*</span>
</span><span id="__span-15-62"><a id="__codelineno-15-62" name="__codelineno-15-62"></a><span class="cm">    *</span>
</span><span id="__span-15-63"><a id="__codelineno-15-63" name="__codelineno-15-63"></a><span class="cm">    *  Add your code here</span>
</span><span id="__span-15-64"><a id="__codelineno-15-64" name="__codelineno-15-64"></a><span class="cm">    *</span>
</span><span id="__span-15-65"><a id="__codelineno-15-65" name="__codelineno-15-65"></a><span class="cm">    *</span>
</span><span id="__span-15-66"><a id="__codelineno-15-66" name="__codelineno-15-66"></a><span class="cm">    */</span>
</span><span id="__span-15-67"><a id="__codelineno-15-67" name="__codelineno-15-67"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-68"><a id="__codelineno-15-68" name="__codelineno-15-68"></a>
</span><span id="__span-15-69"><a id="__codelineno-15-69" name="__codelineno-15-69"></a><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">host_vec_a</span><span class="p">;</span>
</span><span id="__span-15-70"><a id="__codelineno-15-70" name="__codelineno-15-70"></a><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">host_vec_b</span><span class="p">;</span>
</span><span id="__span-15-71"><a id="__codelineno-15-71" name="__codelineno-15-71"></a>
</span><span id="__span-15-72"><a id="__codelineno-15-72" name="__codelineno-15-72"></a>
</span><span id="__span-15-73"><a id="__codelineno-15-73" name="__codelineno-15-73"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">sycl</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-74"><a id="__codelineno-15-74" name="__codelineno-15-74"></a><span class="w">    </span><span class="c1">// Catches exceptions in the host code.</span>
</span><span id="__span-15-75"><a id="__codelineno-15-75" name="__codelineno-15-75"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Caught a SYCL host exception:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-15-76"><a id="__codelineno-15-76" name="__codelineno-15-76"></a>
</span><span id="__span-15-77"><a id="__codelineno-15-77" name="__codelineno-15-77"></a><span class="w">    </span><span class="c1">// Most likely the runtime couldn&#39;t find FPGA hardware!</span>
</span><span id="__span-15-78"><a id="__codelineno-15-78" name="__codelineno-15-78"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">().</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CL_DEVICE_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-79"><a id="__codelineno-15-79" name="__codelineno-15-79"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting an FPGA, please ensure that your &quot;</span>
</span><span id="__span-15-80"><a id="__codelineno-15-80" name="__codelineno-15-80"></a><span class="w">                   </span><span class="s">&quot;system has a correctly configured FPGA board.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-15-81"><a id="__codelineno-15-81" name="__codelineno-15-81"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Run sys_check in the oneAPI root directory to verify.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-15-82"><a id="__codelineno-15-82" name="__codelineno-15-82"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting the FPGA emulator, compile with &quot;</span>
</span><span id="__span-15-83"><a id="__codelineno-15-83" name="__codelineno-15-83"></a><span class="w">                   </span><span class="s">&quot;-DFPGA_EMULATOR.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-15-84"><a id="__codelineno-15-84" name="__codelineno-15-84"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-85"><a id="__codelineno-15-85" name="__codelineno-15-85"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
</span><span id="__span-15-86"><a id="__codelineno-15-86" name="__codelineno-15-86"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-87"><a id="__codelineno-15-87" name="__codelineno-15-87"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
</span><span id="__span-15-88"><a id="__codelineno-15-88" name="__codelineno-15-88"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<ul>
<li>To execute your code, uncomment the following lines in <code>launcher_E04-buffer-transfer.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building&quot;</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DBUILD<span class="o">=</span>EX<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>./E04-buffer-transfer.fpga_emu
</span></code></pre></div></li>
<li>To test the solution, uncomment the following lines in <code>launcher_E04-buffer-transfer.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DPASSWORD<span class="o">=</span><span class="s2">&quot;XXXXXX&quot;</span><span class="w"> </span>-DBUILD<span class="o">=</span>SOL<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>./E04-buffer-transfer.fpga_emu
</span></code></pre></div></li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>To run the fpga image, uncomment the following lines in <code>launcher_E04-buffer-transfer.sh</code></li>
<li>Make sure that the header <code>#SBATCH -p fpga</code> is present
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">JEMALLOC_PRELOAD</span><span class="o">=</span><span class="k">$(</span>jemalloc-config<span class="w"> </span>--libdir<span class="k">)</span>/libjemalloc.so.<span class="k">$(</span>jemalloc-config<span class="w"> </span>--revision<span class="k">)</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nb">cd</span><span class="w"> </span>fpga_image
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="si">${</span><span class="nv">JEMALLOC_PRELOAD</span><span class="si">}</span><span class="w"> </span>./E04-buffer-transfer.fpga
</span></code></pre></div></li>
</ul>
</div>
</div>
</div>
</div>
<h3 id="e05-dot-product">E05-dot-product<a class="headerlink" href="#e05-dot-product" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">Dot-product kernel</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:4"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><input id="__tabbed_5_3" name="__tabbed_5" type="radio" /><input id="__tabbed_5_4" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Instruction</label><label for="__tabbed_5_2">Code description</label><label for="__tabbed_5_3">Emulation (test + solution)</label><label for="__tabbed_5_4">Hardware (Solution)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Go to <code>./exercices/E05-dot-product</code></li>
<li>Create a dot product and call it from the kernel to compute the dot-product between host_vec_a and host_vec_b</li>
<li>Execute your code with the FPGA emulator</li>
<li>Execute the FPGA image in the <code>fpga_image</code> folder</li>
</ul>
</div>
<div class="tabbed-block">
<div class="language-cpp highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">  1</a></span>
<span class="normal"><a href="#__codelineno-19-2">  2</a></span>
<span class="normal"><a href="#__codelineno-19-3">  3</a></span>
<span class="normal"><a href="#__codelineno-19-4">  4</a></span>
<span class="normal"><a href="#__codelineno-19-5">  5</a></span>
<span class="normal"><a href="#__codelineno-19-6">  6</a></span>
<span class="normal"><a href="#__codelineno-19-7">  7</a></span>
<span class="normal"><a href="#__codelineno-19-8">  8</a></span>
<span class="normal"><a href="#__codelineno-19-9">  9</a></span>
<span class="normal"><a href="#__codelineno-19-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-19-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-19-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-19-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-19-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-19-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-19-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-19-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-19-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-19-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-19-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-19-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-19-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-19-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-19-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-19-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-19-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-19-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-19-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-19-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-19-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-19-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-19-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-19-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-19-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-19-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-19-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-19-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-19-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-19-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-19-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-19-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-19-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-19-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-19-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-19-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-19-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-19-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-19-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-19-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-19-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-19-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-19-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-19-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-19-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-19-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-19-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-19-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-19-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-19-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-19-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-19-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-19-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-19-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-19-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-19-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-19-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-19-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-19-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-19-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-19-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-19-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-19-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-19-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-19-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-19-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-19-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-19-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-19-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-19-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-19-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-19-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-19-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-19-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-19-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-19-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-19-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-19-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-19-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-19-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-19-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-19-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-19-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-19-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-19-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-19-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-19-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-19-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-19-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-19-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-19-100">100</a></span>
<span class="normal"><a href="#__codelineno-19-101">101</a></span>
<span class="normal"><a href="#__codelineno-19-102">102</a></span>
<span class="normal"><a href="#__codelineno-19-103">103</a></span>
<span class="normal"><a href="#__codelineno-19-104">104</a></span>
<span class="normal"><a href="#__codelineno-19-105">105</a></span>
<span class="normal"><a href="#__codelineno-19-106">106</a></span>
<span class="normal"><a href="#__codelineno-19-107">107</a></span>
<span class="normal"><a href="#__codelineno-19-108">108</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="c1">// oneAPI headers</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/ext/intel/fpga_extensions.hpp&gt;</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/sycl.hpp&gt;</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6"></a>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7"></a>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="cp">#ifdef __SYCL_DEVICE_ONLY__</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="cp">#define CL_CONSTANT __attribute__((opencl_constant))</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="cp">#else</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="cp">#define CL_CONSTANT</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="cp">#endif</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13"></a>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">sycl</span><span class="p">;</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15"></a>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16"></a>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="k">class</span><span class="w"> </span><span class="nc">DotProductID</span><span class="p">;</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18"></a>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="kt">void</span><span class="w"> </span><span class="nf">DotProduct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">vec_a_in</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">vec_b_in</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">vec_c_out</span><span class="p">,</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="w">               </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21"></a><span class="c1">// Define your dot product here</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="p">}</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23"></a>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24"></a>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25"></a>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">kVectSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30"></a><span class="w">    </span><span class="c1">// Use compile-time macros to select either:</span>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31"></a><span class="w">    </span><span class="c1">//  - the FPGA emulator device (CPU emulation of the FPGA)</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32"></a><span class="w">    </span><span class="c1">//  - the FPGA device (a real FPGA)</span>
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33"></a><span class="w">    </span><span class="c1">//  - the simulator device</span>
</span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34"></a><span class="w">      </span><span class="cp">#if FPGA_SIMULATOR</span>
</span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_simulator_selector_v</span><span class="p">;</span>
</span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36"></a><span class="w">      </span><span class="cp">#elif FPGA_HARDWARE</span>
</span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_selector_v</span><span class="p">;</span>
</span><span id="__span-19-38"><a id="__codelineno-19-38" name="__codelineno-19-38"></a><span class="w">      </span><span class="cp">#else  </span><span class="c1">// #if FPGA_EMULATOR</span>
</span><span id="__span-19-39"><a id="__codelineno-19-39" name="__codelineno-19-39"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_emulator_selector_v</span><span class="p">;</span>
</span><span id="__span-19-40"><a id="__codelineno-19-40" name="__codelineno-19-40"></a><span class="w">      </span><span class="cp">#endif</span>
</span><span id="__span-19-41"><a id="__codelineno-19-41" name="__codelineno-19-41"></a>
</span><span id="__span-19-42"><a id="__codelineno-19-42" name="__codelineno-19-42"></a><span class="w">    </span><span class="c1">// create the device queue</span>
</span><span id="__span-19-43"><a id="__codelineno-19-43" name="__codelineno-19-43"></a><span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">queue</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="n">selector</span><span class="p">);</span>
</span><span id="__span-19-44"><a id="__codelineno-19-44" name="__codelineno-19-44"></a>
</span><span id="__span-19-45"><a id="__codelineno-19-45" name="__codelineno-19-45"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">get_device</span><span class="p">();</span>
</span><span id="__span-19-46"><a id="__codelineno-19-46" name="__codelineno-19-46"></a>
</span><span id="__span-19-47"><a id="__codelineno-19-47" name="__codelineno-19-47"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Running on device: &quot;</span>
</span><span id="__span-19-48"><a id="__codelineno-19-48" name="__codelineno-19-48"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">device</span><span class="p">.</span><span class="n">get_info</span><span class="o">&lt;</span><span class="n">sycl</span><span class="o">::</span><span class="n">info</span><span class="o">::</span><span class="n">device</span><span class="o">::</span><span class="n">name</span><span class="o">&gt;</span><span class="p">().</span><span class="n">c_str</span><span class="p">()</span>
</span><span id="__span-19-49"><a id="__codelineno-19-49" name="__codelineno-19-49"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-19-50"><a id="__codelineno-19-50" name="__codelineno-19-50"></a>
</span><span id="__span-19-51"><a id="__codelineno-19-51" name="__codelineno-19-51"></a>
</span><span id="__span-19-52"><a id="__codelineno-19-52" name="__codelineno-19-52"></a><span class="w">    </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">host_vec_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="n">kVectSize</span><span class="p">];</span>
</span><span id="__span-19-53"><a id="__codelineno-19-53" name="__codelineno-19-53"></a><span class="w">    </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">host_vec_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="n">kVectSize</span><span class="p">];</span>
</span><span id="__span-19-54"><a id="__codelineno-19-54" name="__codelineno-19-54"></a><span class="w">    </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">host_vec_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span id="__span-19-55"><a id="__codelineno-19-55" name="__codelineno-19-55"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">kVectSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-56"><a id="__codelineno-19-56" name="__codelineno-19-56"></a><span class="w">      </span><span class="n">host_vec_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-19-57"><a id="__codelineno-19-57" name="__codelineno-19-57"></a><span class="w">      </span><span class="n">host_vec_b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">kVectSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-19-58"><a id="__codelineno-19-58" name="__codelineno-19-58"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-59"><a id="__codelineno-19-59" name="__codelineno-19-59"></a>
</span><span id="__span-19-60"><a id="__codelineno-19-60" name="__codelineno-19-60"></a>
</span><span id="__span-19-61"><a id="__codelineno-19-61" name="__codelineno-19-61"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Using buffer version&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-19-62"><a id="__codelineno-19-62" name="__codelineno-19-62"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-19-63"><a id="__codelineno-19-63" name="__codelineno-19-63"></a><span class="w">     </span><span class="n">sycl</span><span class="o">::</span><span class="n">buffer</span><span class="w"> </span><span class="n">buffer_vec_a</span><span class="p">{</span><span class="n">host_vec_a</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">range</span><span class="p">(</span><span class="n">kVectSize</span><span class="p">)};</span><span class="w"> </span>
</span><span id="__span-19-64"><a id="__codelineno-19-64" name="__codelineno-19-64"></a><span class="w">     </span><span class="n">sycl</span><span class="o">::</span><span class="n">buffer</span><span class="w"> </span><span class="n">buffer_vec_b</span><span class="p">{</span><span class="n">host_vec_b</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">range</span><span class="p">(</span><span class="n">kVectSize</span><span class="p">)};</span>
</span><span id="__span-19-65"><a id="__codelineno-19-65" name="__codelineno-19-65"></a><span class="w">     </span><span class="n">sycl</span><span class="o">::</span><span class="n">buffer</span><span class="w"> </span><span class="n">buffer_vec_c</span><span class="p">{</span><span class="n">host_vec_c</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">)};</span>
</span><span id="__span-19-66"><a id="__codelineno-19-66" name="__codelineno-19-66"></a><span class="w">     </span><span class="n">q</span><span class="p">.</span><span class="n">submit</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">handler</span><span class="o">&amp;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-67"><a id="__codelineno-19-67" name="__codelineno-19-67"></a><span class="w">       </span><span class="n">sycl</span><span class="o">::</span><span class="n">accessor</span><span class="w"> </span><span class="n">access_vec_a</span><span class="p">{</span><span class="n">buffer_vec_a</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">read_only</span><span class="p">};</span><span class="w"> </span>
</span><span id="__span-19-68"><a id="__codelineno-19-68" name="__codelineno-19-68"></a><span class="w">       </span><span class="n">sycl</span><span class="o">::</span><span class="n">accessor</span><span class="w"> </span><span class="n">access_vec_b</span><span class="p">{</span><span class="n">buffer_vec_b</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">read_only</span><span class="p">};</span><span class="w">  </span>
</span><span id="__span-19-69"><a id="__codelineno-19-69" name="__codelineno-19-69"></a><span class="w">       </span><span class="n">sycl</span><span class="o">::</span><span class="n">accessor</span><span class="w"> </span><span class="n">access_vec_c</span><span class="p">{</span><span class="n">buffer_vec_c</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">write_only</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">no_init</span><span class="p">};</span><span class="w">  </span>
</span><span id="__span-19-70"><a id="__codelineno-19-70" name="__codelineno-19-70"></a><span class="w">       </span><span class="n">h</span><span class="p">.</span><span class="n">single_task</span><span class="o">&lt;</span><span class="n">DotProductID</span><span class="o">&gt;</span><span class="p">([</span><span class="o">=</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-71"><a id="__codelineno-19-71" name="__codelineno-19-71"></a><span class="w">          </span><span class="c1">// Call the the function here</span>
</span><span id="__span-19-72"><a id="__codelineno-19-72" name="__codelineno-19-72"></a><span class="w">          </span><span class="n">DotProduct</span><span class="p">(</span><span class="o">&amp;</span><span class="n">access_vec_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">&amp;</span><span class="n">access_vec_b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">&amp;</span><span class="n">access_vec_c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">kVectSize</span><span class="p">);</span>
</span><span id="__span-19-73"><a id="__codelineno-19-73" name="__codelineno-19-73"></a><span class="w">       </span><span class="p">});</span>
</span><span id="__span-19-74"><a id="__codelineno-19-74" name="__codelineno-19-74"></a><span class="w">     </span><span class="p">});</span>
</span><span id="__span-19-75"><a id="__codelineno-19-75" name="__codelineno-19-75"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-76"><a id="__codelineno-19-76" name="__codelineno-19-76"></a><span class="w">    </span><span class="c1">// verify that correctness</span>
</span><span id="__span-19-77"><a id="__codelineno-19-77" name="__codelineno-19-77"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-19-78"><a id="__codelineno-19-78" name="__codelineno-19-78"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">kVectSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-79"><a id="__codelineno-19-79" name="__codelineno-19-79"></a><span class="w">      </span><span class="n">expected</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">host_vec_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">host_vec_b</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-19-80"><a id="__codelineno-19-80" name="__codelineno-19-80"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-81"><a id="__codelineno-19-81" name="__codelineno-19-81"></a>
</span><span id="__span-19-82"><a id="__codelineno-19-82" name="__codelineno-19-82"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">host_vec_c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">expected</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-83"><a id="__codelineno-19-83" name="__codelineno-19-83"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;expected=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;: result &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">host_vec_c</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-19-84"><a id="__codelineno-19-84" name="__codelineno-19-84"></a><span class="w">      </span><span class="n">passed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-19-85"><a id="__codelineno-19-85" name="__codelineno-19-85"></a><span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span id="__span-19-86"><a id="__codelineno-19-86" name="__codelineno-19-86"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;A.B=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">host_vec_c</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-19-87"><a id="__codelineno-19-87" name="__codelineno-19-87"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-88"><a id="__codelineno-19-88" name="__codelineno-19-88"></a>
</span><span id="__span-19-89"><a id="__codelineno-19-89" name="__codelineno-19-89"></a><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">host_vec_a</span><span class="p">;</span>
</span><span id="__span-19-90"><a id="__codelineno-19-90" name="__codelineno-19-90"></a><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">host_vec_b</span><span class="p">;</span>
</span><span id="__span-19-91"><a id="__codelineno-19-91" name="__codelineno-19-91"></a><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">host_vec_c</span><span class="p">;</span>
</span><span id="__span-19-92"><a id="__codelineno-19-92" name="__codelineno-19-92"></a>
</span><span id="__span-19-93"><a id="__codelineno-19-93" name="__codelineno-19-93"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">sycl</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-94"><a id="__codelineno-19-94" name="__codelineno-19-94"></a><span class="w">    </span><span class="c1">// Catches exceptions in the host code.</span>
</span><span id="__span-19-95"><a id="__codelineno-19-95" name="__codelineno-19-95"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Caught a SYCL host exception:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-19-96"><a id="__codelineno-19-96" name="__codelineno-19-96"></a>
</span><span id="__span-19-97"><a id="__codelineno-19-97" name="__codelineno-19-97"></a><span class="w">    </span><span class="c1">// Most likely the runtime couldn&#39;t find FPGA hardware!</span>
</span><span id="__span-19-98"><a id="__codelineno-19-98" name="__codelineno-19-98"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">().</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CL_DEVICE_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-99"><a id="__codelineno-19-99" name="__codelineno-19-99"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting an FPGA, please ensure that your &quot;</span>
</span><span id="__span-19-100"><a id="__codelineno-19-100" name="__codelineno-19-100"></a><span class="w">                   </span><span class="s">&quot;system has a correctly configured FPGA board.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-19-101"><a id="__codelineno-19-101" name="__codelineno-19-101"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Run sys_check in the oneAPI root directory to verify.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-19-102"><a id="__codelineno-19-102" name="__codelineno-19-102"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting the FPGA emulator, compile with &quot;</span>
</span><span id="__span-19-103"><a id="__codelineno-19-103" name="__codelineno-19-103"></a><span class="w">                   </span><span class="s">&quot;-DFPGA_EMULATOR.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-19-104"><a id="__codelineno-19-104" name="__codelineno-19-104"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-105"><a id="__codelineno-19-105" name="__codelineno-19-105"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
</span><span id="__span-19-106"><a id="__codelineno-19-106" name="__codelineno-19-106"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-107"><a id="__codelineno-19-107" name="__codelineno-19-107"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
</span><span id="__span-19-108"><a id="__codelineno-19-108" name="__codelineno-19-108"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<ul>
<li>To execute your code, uncomment the following lines in <code>launcher_E05-dot-product.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building&quot;</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DBUILD<span class="o">=</span>EX<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>./E05-dot-product.fpga_emu
</span></code></pre></div></li>
<li>To test the solution, uncomment the following lines in <code>launcher_E05-dot-product.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DPASSWORD<span class="o">=</span><span class="s2">&quot;XXXXXX&quot;</span><span class="w"> </span>-DBUILD<span class="o">=</span>SOL<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>./E05-dot-product.fpga_emu
</span></code></pre></div></li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>To run the fpga image, uncomment the following lines in <code>launcher_E05-dot-product.sh</code></li>
<li>Make sure that the header <code>#SBATCH -p fpga</code> is present
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">JEMALLOC_PRELOAD</span><span class="o">=</span><span class="k">$(</span>jemalloc-config<span class="w"> </span>--libdir<span class="k">)</span>/libjemalloc.so.<span class="k">$(</span>jemalloc-config<span class="w"> </span>--revision<span class="k">)</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="nb">cd</span><span class="w"> </span>fpga_image
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="si">${</span><span class="nv">JEMALLOC_PRELOAD</span><span class="si">}</span><span class="w"> </span>./E05-dot-product.fpga
</span></code></pre></div></li>
</ul>
</div>
</div>
</div>
</div>
<h3 id="e06-mat-transpose">E06-mat-transpose<a class="headerlink" href="#e06-mat-transpose" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">Matrix transpose kernel</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:4"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><input id="__tabbed_6_3" name="__tabbed_6" type="radio" /><input id="__tabbed_6_4" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">Instruction</label><label for="__tabbed_6_2">Code description</label><label for="__tabbed_6_3">Emulation (test + solution)</label><label for="__tabbed_6_4">Hardware (Solution)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Go to <code>./exercices/E06-mat-transpose</code></li>
<li>Create a data-parallel kernel transposing a NxN matrix</li>
<li>Execute your code with the FPGA emulator</li>
<li>Execute the FPGA image in the <code>fpga_image</code> folder</li>
</ul>
</div>
<div class="tabbed-block">
<div class="language-cpp highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">  1</a></span>
<span class="normal"><a href="#__codelineno-23-2">  2</a></span>
<span class="normal"><a href="#__codelineno-23-3">  3</a></span>
<span class="normal"><a href="#__codelineno-23-4">  4</a></span>
<span class="normal"><a href="#__codelineno-23-5">  5</a></span>
<span class="normal"><a href="#__codelineno-23-6">  6</a></span>
<span class="normal"><a href="#__codelineno-23-7">  7</a></span>
<span class="normal"><a href="#__codelineno-23-8">  8</a></span>
<span class="normal"><a href="#__codelineno-23-9">  9</a></span>
<span class="normal"><a href="#__codelineno-23-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-23-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-23-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-23-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-23-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-23-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-23-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-23-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-23-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-23-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-23-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-23-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-23-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-23-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-23-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-23-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-23-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-23-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-23-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-23-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-23-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-23-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-23-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-23-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-23-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-23-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-23-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-23-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-23-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-23-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-23-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-23-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-23-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-23-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-23-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-23-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-23-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-23-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-23-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-23-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-23-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-23-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-23-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-23-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-23-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-23-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-23-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-23-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-23-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-23-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-23-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-23-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-23-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-23-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-23-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-23-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-23-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-23-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-23-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-23-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-23-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-23-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-23-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-23-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-23-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-23-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-23-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-23-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-23-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-23-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-23-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-23-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-23-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-23-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-23-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-23-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-23-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-23-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-23-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-23-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-23-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-23-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-23-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-23-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-23-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-23-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-23-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-23-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-23-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-23-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-23-100">100</a></span>
<span class="normal"><a href="#__codelineno-23-101">101</a></span>
<span class="normal"><a href="#__codelineno-23-102">102</a></span>
<span class="normal"><a href="#__codelineno-23-103">103</a></span>
<span class="normal"><a href="#__codelineno-23-104">104</a></span>
<span class="normal"><a href="#__codelineno-23-105">105</a></span>
<span class="normal"><a href="#__codelineno-23-106">106</a></span>
<span class="normal"><a href="#__codelineno-23-107">107</a></span>
<span class="normal"><a href="#__codelineno-23-108">108</a></span>
<span class="normal"><a href="#__codelineno-23-109">109</a></span>
<span class="normal"><a href="#__codelineno-23-110">110</a></span>
<span class="normal"><a href="#__codelineno-23-111">111</a></span>
<span class="normal"><a href="#__codelineno-23-112">112</a></span>
<span class="normal"><a href="#__codelineno-23-113">113</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;random&gt;</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4"></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="c1">// oneAPI headers</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/ext/intel/fpga_extensions.hpp&gt;</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/sycl.hpp&gt;</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8"></a>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9"></a>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="cp">#ifdef __SYCL_DEVICE_ONLY__</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="cp">#define CL_CONSTANT __attribute__((opencl_constant))</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="cp">#else</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="cp">#define CL_CONSTANT</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="cp">#endif</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15"></a>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">sycl</span><span class="p">;</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17"></a>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="cp">#define PRINTF(format, ...)                                    \</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="cp">  {                                                            \</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="cp">    static const CL_CONSTANT char _format[] = format;          \</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21"></a><span class="cp">    ext::oneapi::experimental::printf(_format, ##__VA_ARGS__); \</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22"></a><span class="cp">  }</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23"></a>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24"></a><span class="k">class</span><span class="w"> </span><span class="nc">MatTransposeID</span><span class="p">;</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25"></a>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26"></a>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">kVectSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31"></a><span class="w">    </span><span class="c1">// Use compile-time macros to select either:</span>
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32"></a><span class="w">    </span><span class="c1">//  - the FPGA emulator device (CPU emulation of the FPGA)</span>
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33"></a><span class="w">    </span><span class="c1">//  - the FPGA device (a real FPGA)</span>
</span><span id="__span-23-34"><a id="__codelineno-23-34" name="__codelineno-23-34"></a><span class="w">    </span><span class="c1">//  - the simulator device</span>
</span><span id="__span-23-35"><a id="__codelineno-23-35" name="__codelineno-23-35"></a><span class="w">      </span><span class="cp">#if FPGA_SIMULATOR</span>
</span><span id="__span-23-36"><a id="__codelineno-23-36" name="__codelineno-23-36"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_simulator_selector_v</span><span class="p">;</span>
</span><span id="__span-23-37"><a id="__codelineno-23-37" name="__codelineno-23-37"></a><span class="w">      </span><span class="cp">#elif FPGA_HARDWARE</span>
</span><span id="__span-23-38"><a id="__codelineno-23-38" name="__codelineno-23-38"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_selector_v</span><span class="p">;</span>
</span><span id="__span-23-39"><a id="__codelineno-23-39" name="__codelineno-23-39"></a><span class="w">      </span><span class="cp">#else  </span><span class="c1">// #if FPGA_EMULATOR</span>
</span><span id="__span-23-40"><a id="__codelineno-23-40" name="__codelineno-23-40"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_emulator_selector_v</span><span class="p">;</span>
</span><span id="__span-23-41"><a id="__codelineno-23-41" name="__codelineno-23-41"></a><span class="w">      </span><span class="cp">#endif</span>
</span><span id="__span-23-42"><a id="__codelineno-23-42" name="__codelineno-23-42"></a>
</span><span id="__span-23-43"><a id="__codelineno-23-43" name="__codelineno-23-43"></a><span class="w">    </span><span class="c1">// create the device queue</span>
</span><span id="__span-23-44"><a id="__codelineno-23-44" name="__codelineno-23-44"></a><span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">queue</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="n">selector</span><span class="p">);</span>
</span><span id="__span-23-45"><a id="__codelineno-23-45" name="__codelineno-23-45"></a>
</span><span id="__span-23-46"><a id="__codelineno-23-46" name="__codelineno-23-46"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">get_device</span><span class="p">();</span>
</span><span id="__span-23-47"><a id="__codelineno-23-47" name="__codelineno-23-47"></a>
</span><span id="__span-23-48"><a id="__codelineno-23-48" name="__codelineno-23-48"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Running on device: &quot;</span>
</span><span id="__span-23-49"><a id="__codelineno-23-49" name="__codelineno-23-49"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">device</span><span class="p">.</span><span class="n">get_info</span><span class="o">&lt;</span><span class="n">sycl</span><span class="o">::</span><span class="n">info</span><span class="o">::</span><span class="n">device</span><span class="o">::</span><span class="n">name</span><span class="o">&gt;</span><span class="p">().</span><span class="n">c_str</span><span class="p">()</span>
</span><span id="__span-23-50"><a id="__codelineno-23-50" name="__codelineno-23-50"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-23-51"><a id="__codelineno-23-51" name="__codelineno-23-51"></a>
</span><span id="__span-23-52"><a id="__codelineno-23-52" name="__codelineno-23-52"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">512</span><span class="p">;</span>
</span><span id="__span-23-53"><a id="__codelineno-23-53" name="__codelineno-23-53"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mat</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">N</span><span class="p">);</span>
</span><span id="__span-23-54"><a id="__codelineno-23-54" name="__codelineno-23-54"></a>
</span><span id="__span-23-55"><a id="__codelineno-23-55" name="__codelineno-23-55"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">random_device</span><span class="w"> </span><span class="n">rd</span><span class="p">;</span>
</span><span id="__span-23-56"><a id="__codelineno-23-56" name="__codelineno-23-56"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">mt19937</span><span class="w"> </span><span class="n">mt</span><span class="p">(</span><span class="n">rd</span><span class="p">());</span>
</span><span id="__span-23-57"><a id="__codelineno-23-57" name="__codelineno-23-57"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">uniform_real_distribution</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dist</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
</span><span id="__span-23-58"><a id="__codelineno-23-58" name="__codelineno-23-58"></a>
</span><span id="__span-23-59"><a id="__codelineno-23-59" name="__codelineno-23-59"></a><span class="w">    </span><span class="c1">// Generate random values</span>
</span><span id="__span-23-60"><a id="__codelineno-23-60" name="__codelineno-23-60"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">generate</span><span class="p">(</span><span class="n">mat</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">mat</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">dist</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mt</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-61"><a id="__codelineno-23-61" name="__codelineno-23-61"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">dist</span><span class="p">(</span><span class="n">mt</span><span class="p">);</span>
</span><span id="__span-23-62"><a id="__codelineno-23-62" name="__codelineno-23-62"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-23-63"><a id="__codelineno-23-63" name="__codelineno-23-63"></a>
</span><span id="__span-23-64"><a id="__codelineno-23-64" name="__codelineno-23-64"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">copy_mat</span><span class="p">(</span><span class="n">mat</span><span class="p">);</span>
</span><span id="__span-23-65"><a id="__codelineno-23-65" name="__codelineno-23-65"></a>
</span><span id="__span-23-66"><a id="__codelineno-23-66" name="__codelineno-23-66"></a>
</span><span id="__span-23-67"><a id="__codelineno-23-67" name="__codelineno-23-67"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Using buffer version&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-23-68"><a id="__codelineno-23-68" name="__codelineno-23-68"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-23-69"><a id="__codelineno-23-69" name="__codelineno-23-69"></a><span class="w">     </span><span class="n">sycl</span><span class="o">::</span><span class="n">buffer</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buffer_mat</span><span class="p">{</span><span class="n">mat</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="n">sycl</span><span class="o">::</span><span class="n">range</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">)};</span>
</span><span id="__span-23-70"><a id="__codelineno-23-70" name="__codelineno-23-70"></a><span class="w">     </span><span class="n">q</span><span class="p">.</span><span class="n">submit</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">handler</span><span class="o">&amp;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-71"><a id="__codelineno-23-71" name="__codelineno-23-71"></a><span class="w">       </span><span class="n">sycl</span><span class="o">::</span><span class="n">accessor</span><span class="w"> </span><span class="n">access_mat</span><span class="p">{</span><span class="n">buffer_mat</span><span class="p">,</span><span class="n">h</span><span class="p">};</span><span class="w"> </span>
</span><span id="__span-23-72"><a id="__codelineno-23-72" name="__codelineno-23-72"></a><span class="w">       </span><span class="cm">/*</span>
</span><span id="__span-23-73"><a id="__codelineno-23-73" name="__codelineno-23-73"></a><span class="cm">          *</span>
</span><span id="__span-23-74"><a id="__codelineno-23-74" name="__codelineno-23-74"></a><span class="cm">          *</span>
</span><span id="__span-23-75"><a id="__codelineno-23-75" name="__codelineno-23-75"></a><span class="cm">          *</span>
</span><span id="__span-23-76"><a id="__codelineno-23-76" name="__codelineno-23-76"></a><span class="cm">          *  Define and call the kernel here</span>
</span><span id="__span-23-77"><a id="__codelineno-23-77" name="__codelineno-23-77"></a><span class="cm">          *</span>
</span><span id="__span-23-78"><a id="__codelineno-23-78" name="__codelineno-23-78"></a><span class="cm">          *</span>
</span><span id="__span-23-79"><a id="__codelineno-23-79" name="__codelineno-23-79"></a><span class="cm">          *</span>
</span><span id="__span-23-80"><a id="__codelineno-23-80" name="__codelineno-23-80"></a><span class="cm">          *</span>
</span><span id="__span-23-81"><a id="__codelineno-23-81" name="__codelineno-23-81"></a><span class="cm">        */</span>
</span><span id="__span-23-82"><a id="__codelineno-23-82" name="__codelineno-23-82"></a><span class="w">     </span><span class="p">});</span>
</span><span id="__span-23-83"><a id="__codelineno-23-83" name="__codelineno-23-83"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-84"><a id="__codelineno-23-84" name="__codelineno-23-84"></a>
</span><span id="__span-23-85"><a id="__codelineno-23-85" name="__codelineno-23-85"></a>
</span><span id="__span-23-86"><a id="__codelineno-23-86" name="__codelineno-23-86"></a><span class="w">    </span><span class="c1">// verify that correctness</span>
</span><span id="__span-23-87"><a id="__codelineno-23-87" name="__codelineno-23-87"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-88"><a id="__codelineno-23-88" name="__codelineno-23-88"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-23-89"><a id="__codelineno-23-89" name="__codelineno-23-89"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">copy_mat</span><span class="p">[</span><span class="n">j</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-90"><a id="__codelineno-23-90" name="__codelineno-23-90"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;expected=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">copy_mat</span><span class="p">[</span><span class="n">j</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;: result &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w">  </span><span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-23-91"><a id="__codelineno-23-91" name="__codelineno-23-91"></a><span class="w">            </span><span class="n">passed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-23-92"><a id="__codelineno-23-92" name="__codelineno-23-92"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-23-93"><a id="__codelineno-23-93" name="__codelineno-23-93"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-23-94"><a id="__codelineno-23-94" name="__codelineno-23-94"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-23-95"><a id="__codelineno-23-95" name="__codelineno-23-95"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-96"><a id="__codelineno-23-96" name="__codelineno-23-96"></a>
</span><span id="__span-23-97"><a id="__codelineno-23-97" name="__codelineno-23-97"></a>
</span><span id="__span-23-98"><a id="__codelineno-23-98" name="__codelineno-23-98"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">sycl</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-99"><a id="__codelineno-23-99" name="__codelineno-23-99"></a><span class="w">    </span><span class="c1">// Catches exceptions in the host code.</span>
</span><span id="__span-23-100"><a id="__codelineno-23-100" name="__codelineno-23-100"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Caught a SYCL host exception:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-23-101"><a id="__codelineno-23-101" name="__codelineno-23-101"></a>
</span><span id="__span-23-102"><a id="__codelineno-23-102" name="__codelineno-23-102"></a><span class="w">    </span><span class="c1">// Most likely the runtime couldn&#39;t find FPGA hardware!</span>
</span><span id="__span-23-103"><a id="__codelineno-23-103" name="__codelineno-23-103"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">().</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CL_DEVICE_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-104"><a id="__codelineno-23-104" name="__codelineno-23-104"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting an FPGA, please ensure that your &quot;</span>
</span><span id="__span-23-105"><a id="__codelineno-23-105" name="__codelineno-23-105"></a><span class="w">                   </span><span class="s">&quot;system has a correctly configured FPGA board.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-23-106"><a id="__codelineno-23-106" name="__codelineno-23-106"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Run sys_check in the oneAPI root directory to verify.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-23-107"><a id="__codelineno-23-107" name="__codelineno-23-107"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting the FPGA emulator, compile with &quot;</span>
</span><span id="__span-23-108"><a id="__codelineno-23-108" name="__codelineno-23-108"></a><span class="w">                   </span><span class="s">&quot;-DFPGA_EMULATOR.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-23-109"><a id="__codelineno-23-109" name="__codelineno-23-109"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-110"><a id="__codelineno-23-110" name="__codelineno-23-110"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
</span><span id="__span-23-111"><a id="__codelineno-23-111" name="__codelineno-23-111"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-23-112"><a id="__codelineno-23-112" name="__codelineno-23-112"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
</span><span id="__span-23-113"><a id="__codelineno-23-113" name="__codelineno-23-113"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<ul>
<li>To execute your code, uncomment the following lines in <code>launcher_E06-mat-transpose.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building&quot;</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DBUILD<span class="o">=</span>EX<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>./E06-mat-transpose.fpga_emu
</span></code></pre></div></li>
<li>To test the solution, uncomment the following lines in <code>launcher_E06-mat-transpose.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DPASSWORD<span class="o">=</span><span class="s2">&quot;XXXXXX&quot;</span><span class="w"> </span>-DBUILD<span class="o">=</span>SOL<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>./E06-mat-transpose.fpga_emu
</span></code></pre></div></li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>To run the fpga image, uncomment the following lines in <code>launcher_E06-mat-transpose.sh</code></li>
<li>Make sure that the header <code>#SBATCH -p fpga</code> is present
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">JEMALLOC_PRELOAD</span><span class="o">=</span><span class="k">$(</span>jemalloc-config<span class="w"> </span>--libdir<span class="k">)</span>/libjemalloc.so.<span class="k">$(</span>jemalloc-config<span class="w"> </span>--revision<span class="k">)</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="nb">cd</span><span class="w"> </span>fpga_image
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="si">${</span><span class="nv">JEMALLOC_PRELOAD</span><span class="si">}</span><span class="w"> </span>./E06-mat-transpose.fpga
</span></code></pre></div></li>
</ul>
</div>
</div>
</div>
</div>
<h3 id="e07-shared-memory">E07-shared-memory<a class="headerlink" href="#e07-shared-memory" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">Shared memory example</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:4"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><input id="__tabbed_7_3" name="__tabbed_7" type="radio" /><input id="__tabbed_7_4" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">Instruction</label><label for="__tabbed_7_2">Code description</label><label for="__tabbed_7_3">Emulation (test + solution)</label><label for="__tabbed_7_4">Hardware (Solution)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Go to <code>./exercices/E07-shared-memory</code></li>
<li>The operation that generates a matrix from two vectors is commonly referred to as the <strong>outer product</strong> (also known as the <strong>tensor product</strong> or <strong>dyadic product</strong>) of two vectors.</li>
<li>For two vectors, <strong>a</strong> and <strong>b</strong>, the outer product results in a matrix where each element is the product of the corresponding components of the vectors.</li>
<li>
<p>If:</p>
<ul>
<li>
<p><strong>a</strong> is an <span class="arithmatex">\((N \times 1)\)</span> column vector: <span class="arithmatex">\(a = \begin{bmatrix} 
                                                    a_1 \\ 
                                                    a_2 \\
                                                    \vdots \\ 
                                                    a_N \end{bmatrix}\)</span></p>
</li>
<li>
<p><strong>b</strong> is an (<span class="arithmatex">\(1 \times N)\)</span>  row vector: <span class="arithmatex">\(b = \begin{bmatrix} b_1 &amp; b_2 &amp; . . .  &amp; b_N \end{bmatrix}\)</span></p>
</li>
</ul>
</li>
<li>
<p>Then the outer product of <strong>a</strong> and <strong>b</strong>, denoted by <span class="arithmatex">\( a \otimes b \)</span>, results in an <span class="arithmatex">\( m \times n \)</span> matrix:</p>
<div class="arithmatex">\[a \otimes b = \begin{bmatrix}
a_1 b_1 &amp; a_1 b_2 &amp; \cdots &amp; a_1 b_n \\
a_2 b_1 &amp; a_2 b_2 &amp; \cdots &amp; a_2 b_n \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
a_m b_1 &amp; a_m b_2 &amp; \cdots &amp; a_m b_n
\end{bmatrix}\]</div>
</li>
<li>
<p>This matrix has the element (<span class="arithmatex">\(i, j\)</span>) equal to the product <span class="arithmatex">\(a_i \times b_j\)</span>.</p>
</li>
<li>Compute the outer-product by completing the kernel and use shared memory / group memory to minimize access to the device global memory</li>
</ul>
<p><img alt="" src="../images/sharedmemory.png" width="80%" /></p>
<ul>
<li>Execute your code with the FPGA emulator</li>
<li>Execute the FPGA image in the <code>fpga_image</code> folder</li>
</ul>
</div>
<div class="tabbed-block">
<div class="language-cpp highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">  1</a></span>
<span class="normal"><a href="#__codelineno-27-2">  2</a></span>
<span class="normal"><a href="#__codelineno-27-3">  3</a></span>
<span class="normal"><a href="#__codelineno-27-4">  4</a></span>
<span class="normal"><a href="#__codelineno-27-5">  5</a></span>
<span class="normal"><a href="#__codelineno-27-6">  6</a></span>
<span class="normal"><a href="#__codelineno-27-7">  7</a></span>
<span class="normal"><a href="#__codelineno-27-8">  8</a></span>
<span class="normal"><a href="#__codelineno-27-9">  9</a></span>
<span class="normal"><a href="#__codelineno-27-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-27-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-27-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-27-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-27-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-27-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-27-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-27-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-27-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-27-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-27-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-27-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-27-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-27-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-27-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-27-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-27-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-27-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-27-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-27-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-27-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-27-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-27-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-27-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-27-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-27-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-27-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-27-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-27-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-27-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-27-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-27-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-27-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-27-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-27-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-27-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-27-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-27-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-27-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-27-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-27-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-27-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-27-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-27-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-27-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-27-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-27-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-27-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-27-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-27-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-27-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-27-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-27-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-27-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-27-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-27-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-27-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-27-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-27-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-27-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-27-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-27-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-27-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-27-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-27-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-27-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-27-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-27-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-27-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-27-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-27-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-27-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-27-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-27-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-27-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-27-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-27-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-27-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-27-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-27-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-27-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-27-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-27-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-27-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-27-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-27-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-27-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-27-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-27-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-27-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-27-100">100</a></span>
<span class="normal"><a href="#__codelineno-27-101">101</a></span>
<span class="normal"><a href="#__codelineno-27-102">102</a></span>
<span class="normal"><a href="#__codelineno-27-103">103</a></span>
<span class="normal"><a href="#__codelineno-27-104">104</a></span>
<span class="normal"><a href="#__codelineno-27-105">105</a></span>
<span class="normal"><a href="#__codelineno-27-106">106</a></span>
<span class="normal"><a href="#__codelineno-27-107">107</a></span>
<span class="normal"><a href="#__codelineno-27-108">108</a></span>
<span class="normal"><a href="#__codelineno-27-109">109</a></span>
<span class="normal"><a href="#__codelineno-27-110">110</a></span>
<span class="normal"><a href="#__codelineno-27-111">111</a></span>
<span class="normal"><a href="#__codelineno-27-112">112</a></span>
<span class="normal"><a href="#__codelineno-27-113">113</a></span>
<span class="normal"><a href="#__codelineno-27-114">114</a></span>
<span class="normal"><a href="#__codelineno-27-115">115</a></span>
<span class="normal"><a href="#__codelineno-27-116">116</a></span>
<span class="normal"><a href="#__codelineno-27-117">117</a></span>
<span class="normal"><a href="#__codelineno-27-118">118</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="c1">// oneAPI headers</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/ext/intel/fpga_extensions.hpp&gt;</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/sycl.hpp&gt;</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6"></a>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7"></a>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="cp">#ifdef __SYCL_DEVICE_ONLY__</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="cp">#define CL_CONSTANT __attribute__((opencl_constant))</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="cp">#else</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="cp">#define CL_CONSTANT</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="cp">#endif</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13"></a>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">sycl</span><span class="p">;</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15"></a>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16"></a><span class="cp">#define PRINTF(format, ...)                                    \</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17"></a><span class="cp">  {                                                            \</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18"></a><span class="cp">    static const CL_CONSTANT char _format[] = format;          \</span>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19"></a><span class="cp">    ext::oneapi::experimental::printf(_format, ##__VA_ARGS__); \</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20"></a><span class="cp">  }</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21"></a>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22"></a><span class="k">class</span><span class="w"> </span><span class="nc">VecProductPID</span><span class="p">;</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23"></a>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24"></a>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-27-27"><a id="__codelineno-27-27" name="__codelineno-27-27"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">kVectSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
</span><span id="__span-27-28"><a id="__codelineno-27-28" name="__codelineno-27-28"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">blockSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span>
</span><span id="__span-27-29"><a id="__codelineno-27-29" name="__codelineno-27-29"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-30"><a id="__codelineno-27-30" name="__codelineno-27-30"></a><span class="w">    </span><span class="c1">// Use compile-time macros to select either:</span>
</span><span id="__span-27-31"><a id="__codelineno-27-31" name="__codelineno-27-31"></a><span class="w">    </span><span class="c1">//  - the FPGA emulator device (CPU emulation of the FPGA)</span>
</span><span id="__span-27-32"><a id="__codelineno-27-32" name="__codelineno-27-32"></a><span class="w">    </span><span class="c1">//  - the FPGA device (a real FPGA)</span>
</span><span id="__span-27-33"><a id="__codelineno-27-33" name="__codelineno-27-33"></a><span class="w">    </span><span class="c1">//  - the simulator device</span>
</span><span id="__span-27-34"><a id="__codelineno-27-34" name="__codelineno-27-34"></a><span class="w">      </span><span class="cp">#if FPGA_SIMULATOR</span>
</span><span id="__span-27-35"><a id="__codelineno-27-35" name="__codelineno-27-35"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_simulator_selector_v</span><span class="p">;</span>
</span><span id="__span-27-36"><a id="__codelineno-27-36" name="__codelineno-27-36"></a><span class="w">      </span><span class="cp">#elif FPGA_HARDWARE</span>
</span><span id="__span-27-37"><a id="__codelineno-27-37" name="__codelineno-27-37"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_selector_v</span><span class="p">;</span>
</span><span id="__span-27-38"><a id="__codelineno-27-38" name="__codelineno-27-38"></a><span class="w">      </span><span class="cp">#else  </span><span class="c1">// #if FPGA_EMULATOR</span>
</span><span id="__span-27-39"><a id="__codelineno-27-39" name="__codelineno-27-39"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_emulator_selector_v</span><span class="p">;</span>
</span><span id="__span-27-40"><a id="__codelineno-27-40" name="__codelineno-27-40"></a><span class="w">      </span><span class="cp">#endif</span>
</span><span id="__span-27-41"><a id="__codelineno-27-41" name="__codelineno-27-41"></a>
</span><span id="__span-27-42"><a id="__codelineno-27-42" name="__codelineno-27-42"></a><span class="w">    </span><span class="c1">// create the device queue</span>
</span><span id="__span-27-43"><a id="__codelineno-27-43" name="__codelineno-27-43"></a><span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">queue</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="n">selector</span><span class="p">);</span>
</span><span id="__span-27-44"><a id="__codelineno-27-44" name="__codelineno-27-44"></a>
</span><span id="__span-27-45"><a id="__codelineno-27-45" name="__codelineno-27-45"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">get_device</span><span class="p">();</span>
</span><span id="__span-27-46"><a id="__codelineno-27-46" name="__codelineno-27-46"></a>
</span><span id="__span-27-47"><a id="__codelineno-27-47" name="__codelineno-27-47"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Running on device: &quot;</span>
</span><span id="__span-27-48"><a id="__codelineno-27-48" name="__codelineno-27-48"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">device</span><span class="p">.</span><span class="n">get_info</span><span class="o">&lt;</span><span class="n">sycl</span><span class="o">::</span><span class="n">info</span><span class="o">::</span><span class="n">device</span><span class="o">::</span><span class="n">name</span><span class="o">&gt;</span><span class="p">().</span><span class="n">c_str</span><span class="p">()</span>
</span><span id="__span-27-49"><a id="__codelineno-27-49" name="__codelineno-27-49"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-27-50"><a id="__codelineno-27-50" name="__codelineno-27-50"></a>
</span><span id="__span-27-51"><a id="__codelineno-27-51" name="__codelineno-27-51"></a>
</span><span id="__span-27-52"><a id="__codelineno-27-52" name="__codelineno-27-52"></a><span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">host_vec_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">float</span><span class="p">[</span><span class="n">kVectSize</span><span class="p">];</span>
</span><span id="__span-27-53"><a id="__codelineno-27-53" name="__codelineno-27-53"></a><span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">host_vec_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">float</span><span class="p">[</span><span class="n">kVectSize</span><span class="p">];</span>
</span><span id="__span-27-54"><a id="__codelineno-27-54" name="__codelineno-27-54"></a><span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">host_vec_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">float</span><span class="p">[</span><span class="n">kVectSize</span><span class="o">*</span><span class="n">kVectSize</span><span class="p">];</span>
</span><span id="__span-27-55"><a id="__codelineno-27-55" name="__codelineno-27-55"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">kVectSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-56"><a id="__codelineno-27-56" name="__codelineno-27-56"></a><span class="w">      </span><span class="n">host_vec_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-27-57"><a id="__codelineno-27-57" name="__codelineno-27-57"></a><span class="w">      </span><span class="n">host_vec_b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">kVectSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-27-58"><a id="__codelineno-27-58" name="__codelineno-27-58"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-59"><a id="__codelineno-27-59" name="__codelineno-27-59"></a>
</span><span id="__span-27-60"><a id="__codelineno-27-60" name="__codelineno-27-60"></a>
</span><span id="__span-27-61"><a id="__codelineno-27-61" name="__codelineno-27-61"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Using buffer version&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-27-62"><a id="__codelineno-27-62" name="__codelineno-27-62"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-27-63"><a id="__codelineno-27-63" name="__codelineno-27-63"></a><span class="w">     </span><span class="n">sycl</span><span class="o">::</span><span class="n">buffer</span><span class="w"> </span><span class="n">buffer_vec_a</span><span class="p">{</span><span class="n">host_vec_a</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">range</span><span class="p">(</span><span class="n">kVectSize</span><span class="p">)};</span><span class="w"> </span>
</span><span id="__span-27-64"><a id="__codelineno-27-64" name="__codelineno-27-64"></a><span class="w">     </span><span class="n">sycl</span><span class="o">::</span><span class="n">buffer</span><span class="w"> </span><span class="n">buffer_vec_b</span><span class="p">{</span><span class="n">host_vec_b</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">range</span><span class="p">(</span><span class="n">kVectSize</span><span class="p">)};</span>
</span><span id="__span-27-65"><a id="__codelineno-27-65" name="__codelineno-27-65"></a><span class="w">     </span><span class="n">sycl</span><span class="o">::</span><span class="n">buffer</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buffer_vec_c</span><span class="p">{</span><span class="n">host_vec_c</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">range</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kVectSize</span><span class="p">,</span><span class="n">kVectSize</span><span class="p">)};</span>
</span><span id="__span-27-66"><a id="__codelineno-27-66" name="__codelineno-27-66"></a><span class="w">     </span><span class="n">q</span><span class="p">.</span><span class="n">submit</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">handler</span><span class="o">&amp;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-67"><a id="__codelineno-27-67" name="__codelineno-27-67"></a><span class="w">       </span><span class="n">sycl</span><span class="o">::</span><span class="n">accessor</span><span class="w"> </span><span class="n">access_vec_a</span><span class="p">{</span><span class="n">buffer_vec_a</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">read_only</span><span class="p">};</span><span class="w"> </span>
</span><span id="__span-27-68"><a id="__codelineno-27-68" name="__codelineno-27-68"></a><span class="w">       </span><span class="n">sycl</span><span class="o">::</span><span class="n">accessor</span><span class="w"> </span><span class="n">access_vec_b</span><span class="p">{</span><span class="n">buffer_vec_b</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">read_only</span><span class="p">};</span><span class="w">  </span>
</span><span id="__span-27-69"><a id="__codelineno-27-69" name="__codelineno-27-69"></a><span class="w">       </span><span class="n">sycl</span><span class="o">::</span><span class="n">accessor</span><span class="w"> </span><span class="n">access_vec_c</span><span class="p">{</span><span class="n">buffer_vec_c</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">write_only</span><span class="p">,</span><span class="n">sycl</span><span class="o">::</span><span class="n">no_init</span><span class="p">};</span><span class="w">  </span>
</span><span id="__span-27-70"><a id="__codelineno-27-70" name="__codelineno-27-70"></a><span class="w">       </span><span class="n">sycl</span><span class="o">::</span><span class="n">local_accessor</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="n">shared_mem</span><span class="p">{</span><span class="n">blockSize</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">};</span>
</span><span id="__span-27-71"><a id="__codelineno-27-71" name="__codelineno-27-71"></a><span class="w">       </span><span class="n">h</span><span class="p">.</span><span class="n">parallel_for</span><span class="o">&lt;</span><span class="n">VecProductPID</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sycl</span><span class="o">::</span><span class="n">nd_range</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">({</span><span class="n">kVectSize</span><span class="p">,</span><span class="n">blockSize</span><span class="p">}),[</span><span class="o">=</span><span class="p">](</span><span class="n">sycl</span><span class="o">::</span><span class="n">nd_item</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="n">item</span><span class="p">){</span><span class="w"> </span>
</span><span id="__span-27-72"><a id="__codelineno-27-72" name="__codelineno-27-72"></a><span class="w">         </span><span class="kt">int</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">get_global_id</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
</span><span id="__span-27-73"><a id="__codelineno-27-73" name="__codelineno-27-73"></a><span class="w">         </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">get_local_id</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
</span><span id="__span-27-74"><a id="__codelineno-27-74" name="__codelineno-27-74"></a><span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">kVectSize</span><span class="o">/</span><span class="n">blockSize</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-75"><a id="__codelineno-27-75" name="__codelineno-27-75"></a><span class="w">            </span><span class="cm">/*</span>
</span><span id="__span-27-76"><a id="__codelineno-27-76" name="__codelineno-27-76"></a><span class="cm">            *</span>
</span><span id="__span-27-77"><a id="__codelineno-27-77" name="__codelineno-27-77"></a><span class="cm">            * Add your code here</span>
</span><span id="__span-27-78"><a id="__codelineno-27-78" name="__codelineno-27-78"></a><span class="cm">            *</span>
</span><span id="__span-27-79"><a id="__codelineno-27-79" name="__codelineno-27-79"></a><span class="cm">            */</span>
</span><span id="__span-27-80"><a id="__codelineno-27-80" name="__codelineno-27-80"></a><span class="w">         </span><span class="p">}</span>
</span><span id="__span-27-81"><a id="__codelineno-27-81" name="__codelineno-27-81"></a><span class="w">       </span><span class="p">});</span>
</span><span id="__span-27-82"><a id="__codelineno-27-82" name="__codelineno-27-82"></a><span class="w">     </span><span class="p">});</span>
</span><span id="__span-27-83"><a id="__codelineno-27-83" name="__codelineno-27-83"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-84"><a id="__codelineno-27-84" name="__codelineno-27-84"></a>
</span><span id="__span-27-85"><a id="__codelineno-27-85" name="__codelineno-27-85"></a>
</span><span id="__span-27-86"><a id="__codelineno-27-86" name="__codelineno-27-86"></a><span class="w">    </span><span class="c1">// verify that correctness</span>
</span><span id="__span-27-87"><a id="__codelineno-27-87" name="__codelineno-27-87"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">kVectSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-88"><a id="__codelineno-27-88" name="__codelineno-27-88"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">kVectSize</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-27-89"><a id="__codelineno-27-89" name="__codelineno-27-89"></a><span class="w">          </span><span class="kt">float</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">host_vec_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">host_vec_b</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
</span><span id="__span-27-90"><a id="__codelineno-27-90" name="__codelineno-27-90"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">expected</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">host_vec_c</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">kVectSize</span><span class="o">+</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-91"><a id="__codelineno-27-91" name="__codelineno-27-91"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;expected=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;: result &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">host_vec_c</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-27-92"><a id="__codelineno-27-92" name="__codelineno-27-92"></a><span class="w">            </span><span class="n">passed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-27-93"><a id="__codelineno-27-93" name="__codelineno-27-93"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-27-94"><a id="__codelineno-27-94" name="__codelineno-27-94"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-27-95"><a id="__codelineno-27-95" name="__codelineno-27-95"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-27-96"><a id="__codelineno-27-96" name="__codelineno-27-96"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-97"><a id="__codelineno-27-97" name="__codelineno-27-97"></a>
</span><span id="__span-27-98"><a id="__codelineno-27-98" name="__codelineno-27-98"></a><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">host_vec_a</span><span class="p">;</span>
</span><span id="__span-27-99"><a id="__codelineno-27-99" name="__codelineno-27-99"></a><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">host_vec_b</span><span class="p">;</span>
</span><span id="__span-27-100"><a id="__codelineno-27-100" name="__codelineno-27-100"></a><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">host_vec_c</span><span class="p">;</span>
</span><span id="__span-27-101"><a id="__codelineno-27-101" name="__codelineno-27-101"></a>
</span><span id="__span-27-102"><a id="__codelineno-27-102" name="__codelineno-27-102"></a>
</span><span id="__span-27-103"><a id="__codelineno-27-103" name="__codelineno-27-103"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">sycl</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-104"><a id="__codelineno-27-104" name="__codelineno-27-104"></a><span class="w">    </span><span class="c1">// Catches exceptions in the host code.</span>
</span><span id="__span-27-105"><a id="__codelineno-27-105" name="__codelineno-27-105"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Caught a SYCL host exception:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-27-106"><a id="__codelineno-27-106" name="__codelineno-27-106"></a>
</span><span id="__span-27-107"><a id="__codelineno-27-107" name="__codelineno-27-107"></a><span class="w">    </span><span class="c1">// Most likely the runtime couldn&#39;t find FPGA hardware!</span>
</span><span id="__span-27-108"><a id="__codelineno-27-108" name="__codelineno-27-108"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">().</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CL_DEVICE_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-109"><a id="__codelineno-27-109" name="__codelineno-27-109"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting an FPGA, please ensure that your &quot;</span>
</span><span id="__span-27-110"><a id="__codelineno-27-110" name="__codelineno-27-110"></a><span class="w">                   </span><span class="s">&quot;system has a correctly configured FPGA board.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-27-111"><a id="__codelineno-27-111" name="__codelineno-27-111"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Run sys_check in the oneAPI root directory to verify.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-27-112"><a id="__codelineno-27-112" name="__codelineno-27-112"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting the FPGA emulator, compile with &quot;</span>
</span><span id="__span-27-113"><a id="__codelineno-27-113" name="__codelineno-27-113"></a><span class="w">                   </span><span class="s">&quot;-DFPGA_EMULATOR.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-27-114"><a id="__codelineno-27-114" name="__codelineno-27-114"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-115"><a id="__codelineno-27-115" name="__codelineno-27-115"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
</span><span id="__span-27-116"><a id="__codelineno-27-116" name="__codelineno-27-116"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-117"><a id="__codelineno-27-117" name="__codelineno-27-117"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
</span><span id="__span-27-118"><a id="__codelineno-27-118" name="__codelineno-27-118"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<ul>
<li>To execute your code, uncomment the following lines in <code>launcher_E07-shared-memory.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building&quot;</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DBUILD<span class="o">=</span>EX<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>./E07-shared-memory.fpga_emu
</span></code></pre></div></li>
<li>To test the solution, uncomment the following lines in <code>launcher_E07-shared-memory.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DPASSWORD<span class="o">=</span><span class="s2">&quot;XXXXXX&quot;</span><span class="w"> </span>-DBUILD<span class="o">=</span>SOL<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>./E07-shared-memory.fpga_emu
</span></code></pre></div></li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>To run the fpga image, uncomment the following lines in <code>launcher_E07-shared-memory.sh</code></li>
<li>Make sure that the header <code>#SBATCH -p fpga</code> is present
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">JEMALLOC_PRELOAD</span><span class="o">=</span><span class="k">$(</span>jemalloc-config<span class="w"> </span>--libdir<span class="k">)</span>/libjemalloc.so.<span class="k">$(</span>jemalloc-config<span class="w"> </span>--revision<span class="k">)</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="nb">cd</span><span class="w"> </span>fpga_image
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="si">${</span><span class="nv">JEMALLOC_PRELOAD</span><span class="si">}</span><span class="w"> </span>./E07-shared-memory.fpga
</span></code></pre></div></li>
</ul>
</div>
</div>
</div>
</div>
<h3 id="e08-pipe">E08-pipe<a class="headerlink" href="#e08-pipe" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">Fibonnaci ping-pong</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:4"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><input id="__tabbed_8_3" name="__tabbed_8" type="radio" /><input id="__tabbed_8_4" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">Instruction</label><label for="__tabbed_8_2">Code description</label><label for="__tabbed_8_3">Emulation (test + solution)</label><label for="__tabbed_8_4">Hardware (Solution)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Go to <code>./exercices/E08-pipe</code></li>
<li>Using two kernels and pipes, compute the Fibonnaci sequence using both kernels by exchanging everytime the value computing by one kernel with the other one. </li>
<li><u><strong>Fibonacci Formula</strong></u>:</li>
<li><span class="arithmatex">\(F(n)\)</span> is the nth Fibonacci number</li>
<li><span class="arithmatex">\(F(0) = 0\)</span> and <span class="arithmatex">\(F(1) = 1\)</span> are the base cases</li>
<li><span class="arithmatex">\(F(n) = F(n-1) + F(n-2)\)</span>
<img alt="" src="../images/pipe.png" /></li>
<li>Execute your code with the FPGA emulator</li>
<li>Execute the FPGA image in the <code>fpga_image</code> folder</li>
</ul>
</div>
<div class="tabbed-block">
<div class="language-cpp highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">  1</a></span>
<span class="normal"><a href="#__codelineno-31-2">  2</a></span>
<span class="normal"><a href="#__codelineno-31-3">  3</a></span>
<span class="normal"><a href="#__codelineno-31-4">  4</a></span>
<span class="normal"><a href="#__codelineno-31-5">  5</a></span>
<span class="normal"><a href="#__codelineno-31-6">  6</a></span>
<span class="normal"><a href="#__codelineno-31-7">  7</a></span>
<span class="normal"><a href="#__codelineno-31-8">  8</a></span>
<span class="normal"><a href="#__codelineno-31-9">  9</a></span>
<span class="normal"><a href="#__codelineno-31-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-31-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-31-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-31-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-31-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-31-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-31-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-31-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-31-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-31-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-31-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-31-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-31-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-31-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-31-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-31-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-31-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-31-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-31-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-31-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-31-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-31-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-31-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-31-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-31-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-31-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-31-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-31-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-31-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-31-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-31-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-31-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-31-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-31-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-31-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-31-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-31-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-31-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-31-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-31-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-31-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-31-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-31-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-31-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-31-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-31-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-31-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-31-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-31-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-31-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-31-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-31-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-31-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-31-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-31-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-31-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-31-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-31-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-31-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-31-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-31-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-31-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-31-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-31-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-31-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-31-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-31-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-31-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-31-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-31-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-31-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-31-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-31-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-31-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-31-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-31-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-31-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-31-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-31-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-31-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-31-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-31-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-31-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-31-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-31-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-31-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-31-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-31-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-31-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-31-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-31-100">100</a></span>
<span class="normal"><a href="#__codelineno-31-101">101</a></span>
<span class="normal"><a href="#__codelineno-31-102">102</a></span>
<span class="normal"><a href="#__codelineno-31-103">103</a></span>
<span class="normal"><a href="#__codelineno-31-104">104</a></span>
<span class="normal"><a href="#__codelineno-31-105">105</a></span>
<span class="normal"><a href="#__codelineno-31-106">106</a></span>
<span class="normal"><a href="#__codelineno-31-107">107</a></span>
<span class="normal"><a href="#__codelineno-31-108">108</a></span>
<span class="normal"><a href="#__codelineno-31-109">109</a></span>
<span class="normal"><a href="#__codelineno-31-110">110</a></span>
<span class="normal"><a href="#__codelineno-31-111">111</a></span>
<span class="normal"><a href="#__codelineno-31-112">112</a></span>
<span class="normal"><a href="#__codelineno-31-113">113</a></span>
<span class="normal"><a href="#__codelineno-31-114">114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2"></a>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="c1">// oneAPI headers</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/ext/intel/fpga_extensions.hpp&gt;</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/sycl.hpp&gt;</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6"></a>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7"></a>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="cp">#ifdef __SYCL_DEVICE_ONLY__</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="cp">#define CL_CONSTANT __attribute__((opencl_constant))</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="cp">#else</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="cp">#define CL_CONSTANT</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="cp">#endif</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13"></a>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">sycl</span><span class="p">;</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15"></a>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16"></a><span class="cp">#define PRINTF(format, ...)                                    \</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="cp">  {                                                            \</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18"></a><span class="cp">    static const CL_CONSTANT char _format[] = format;          \</span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="cp">    ext::oneapi::experimental::printf(_format, ##__VA_ARGS__); \</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="cp">  }</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21"></a>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22"></a><span class="k">class</span><span class="w"> </span><span class="nc">PingID</span><span class="p">;</span>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23"></a><span class="k">class</span><span class="w"> </span><span class="nc">PongID</span><span class="p">;</span>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24"></a>
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="p">;</span>
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29"></a><span class="w">    </span><span class="c1">// Use compile-time macros to select either:</span>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30"></a><span class="w">    </span><span class="c1">//  - the FPGA emulator device (CPU emulation of the FPGA)</span>
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31"></a><span class="w">    </span><span class="c1">//  - the FPGA device (a real FPGA)</span>
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32"></a><span class="w">    </span><span class="c1">//  - the simulator device</span>
</span><span id="__span-31-33"><a id="__codelineno-31-33" name="__codelineno-31-33"></a><span class="w">      </span><span class="cp">#if FPGA_SIMULATOR</span>
</span><span id="__span-31-34"><a id="__codelineno-31-34" name="__codelineno-31-34"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_simulator_selector_v</span><span class="p">;</span>
</span><span id="__span-31-35"><a id="__codelineno-31-35" name="__codelineno-31-35"></a><span class="w">      </span><span class="cp">#elif FPGA_HARDWARE</span>
</span><span id="__span-31-36"><a id="__codelineno-31-36" name="__codelineno-31-36"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_selector_v</span><span class="p">;</span>
</span><span id="__span-31-37"><a id="__codelineno-31-37" name="__codelineno-31-37"></a><span class="w">      </span><span class="cp">#else  </span><span class="c1">// #if FPGA_EMULATOR</span>
</span><span id="__span-31-38"><a id="__codelineno-31-38" name="__codelineno-31-38"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_emulator_selector_v</span><span class="p">;</span>
</span><span id="__span-31-39"><a id="__codelineno-31-39" name="__codelineno-31-39"></a><span class="w">      </span><span class="cp">#endif</span>
</span><span id="__span-31-40"><a id="__codelineno-31-40" name="__codelineno-31-40"></a>
</span><span id="__span-31-41"><a id="__codelineno-31-41" name="__codelineno-31-41"></a><span class="w">    </span><span class="c1">// create the device queue</span>
</span><span id="__span-31-42"><a id="__codelineno-31-42" name="__codelineno-31-42"></a><span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">queue</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="n">selector</span><span class="p">);</span>
</span><span id="__span-31-43"><a id="__codelineno-31-43" name="__codelineno-31-43"></a>
</span><span id="__span-31-44"><a id="__codelineno-31-44" name="__codelineno-31-44"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">get_device</span><span class="p">();</span>
</span><span id="__span-31-45"><a id="__codelineno-31-45" name="__codelineno-31-45"></a>
</span><span id="__span-31-46"><a id="__codelineno-31-46" name="__codelineno-31-46"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Running on device: &quot;</span>
</span><span id="__span-31-47"><a id="__codelineno-31-47" name="__codelineno-31-47"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">device</span><span class="p">.</span><span class="n">get_info</span><span class="o">&lt;</span><span class="n">sycl</span><span class="o">::</span><span class="n">info</span><span class="o">::</span><span class="n">device</span><span class="o">::</span><span class="n">name</span><span class="o">&gt;</span><span class="p">().</span><span class="n">c_str</span><span class="p">()</span>
</span><span id="__span-31-48"><a id="__codelineno-31-48" name="__codelineno-31-48"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-31-49"><a id="__codelineno-31-49" name="__codelineno-31-49"></a>
</span><span id="__span-31-50"><a id="__codelineno-31-50" name="__codelineno-31-50"></a>
</span><span id="__span-31-51"><a id="__codelineno-31-51" name="__codelineno-31-51"></a>
</span><span id="__span-31-52"><a id="__codelineno-31-52" name="__codelineno-31-52"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Using USM device&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-31-53"><a id="__codelineno-31-53" name="__codelineno-31-53"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">pipeA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">pipe</span><span class="o">&lt;</span><span class="w">      </span>
</span><span id="__span-31-54"><a id="__codelineno-31-54" name="__codelineno-31-54"></a><span class="w">                </span><span class="k">class</span><span class="w"> </span><span class="nc">Ping2Pong</span><span class="p">,</span>
</span><span id="__span-31-55"><a id="__codelineno-31-55" name="__codelineno-31-55"></a><span class="w">                </span><span class="kt">long</span><span class="p">,</span><span class="w">           </span>
</span><span id="__span-31-56"><a id="__codelineno-31-56" name="__codelineno-31-56"></a><span class="w">                </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">;</span><span class="w">             </span>
</span><span id="__span-31-57"><a id="__codelineno-31-57" name="__codelineno-31-57"></a>
</span><span id="__span-31-58"><a id="__codelineno-31-58" name="__codelineno-31-58"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">pipeB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">pipe</span><span class="o">&lt;</span><span class="w">      </span>
</span><span id="__span-31-59"><a id="__codelineno-31-59" name="__codelineno-31-59"></a><span class="w">                </span><span class="k">class</span><span class="w"> </span><span class="nc">Pong2Ping</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-31-60"><a id="__codelineno-31-60" name="__codelineno-31-60"></a><span class="w">                </span><span class="kt">long</span><span class="p">,</span><span class="w">            </span>
</span><span id="__span-31-61"><a id="__codelineno-31-61" name="__codelineno-31-61"></a><span class="w">                </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">;</span><span class="w">              </span>
</span><span id="__span-31-62"><a id="__codelineno-31-62" name="__codelineno-31-62"></a><span class="w">     </span><span class="n">q</span><span class="p">.</span><span class="n">submit</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">handler</span><span class="o">&amp;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-63"><a id="__codelineno-31-63" name="__codelineno-31-63"></a><span class="w">       </span><span class="n">h</span><span class="p">.</span><span class="n">single_task</span><span class="o">&lt;</span><span class="n">PingID</span><span class="o">&gt;</span><span class="p">([</span><span class="o">=</span><span class="p">](){</span><span class="w"> </span>
</span><span id="__span-31-64"><a id="__codelineno-31-64" name="__codelineno-31-64"></a><span class="w">        </span><span class="cm">/*</span>
</span><span id="__span-31-65"><a id="__codelineno-31-65" name="__codelineno-31-65"></a><span class="cm">        *</span>
</span><span id="__span-31-66"><a id="__codelineno-31-66" name="__codelineno-31-66"></a><span class="cm">        * Add the code for the Ping kernel</span>
</span><span id="__span-31-67"><a id="__codelineno-31-67" name="__codelineno-31-67"></a><span class="cm">        *</span>
</span><span id="__span-31-68"><a id="__codelineno-31-68" name="__codelineno-31-68"></a><span class="cm">        *</span>
</span><span id="__span-31-69"><a id="__codelineno-31-69" name="__codelineno-31-69"></a><span class="cm">        */</span>
</span><span id="__span-31-70"><a id="__codelineno-31-70" name="__codelineno-31-70"></a><span class="w">       </span><span class="p">});</span>
</span><span id="__span-31-71"><a id="__codelineno-31-71" name="__codelineno-31-71"></a><span class="w">     </span><span class="p">});</span>
</span><span id="__span-31-72"><a id="__codelineno-31-72" name="__codelineno-31-72"></a>
</span><span id="__span-31-73"><a id="__codelineno-31-73" name="__codelineno-31-73"></a><span class="w">     </span><span class="n">q</span><span class="p">.</span><span class="n">submit</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">handler</span><span class="o">&amp;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-74"><a id="__codelineno-31-74" name="__codelineno-31-74"></a><span class="w">       </span><span class="n">h</span><span class="p">.</span><span class="n">single_task</span><span class="o">&lt;</span><span class="n">PongID</span><span class="o">&gt;</span><span class="p">([</span><span class="o">=</span><span class="p">](){</span><span class="w"> </span>
</span><span id="__span-31-75"><a id="__codelineno-31-75" name="__codelineno-31-75"></a><span class="w">        </span><span class="cm">/*</span>
</span><span id="__span-31-76"><a id="__codelineno-31-76" name="__codelineno-31-76"></a><span class="cm">        *</span>
</span><span id="__span-31-77"><a id="__codelineno-31-77" name="__codelineno-31-77"></a><span class="cm">        * Add the code for the Pong kernel</span>
</span><span id="__span-31-78"><a id="__codelineno-31-78" name="__codelineno-31-78"></a><span class="cm">        *</span>
</span><span id="__span-31-79"><a id="__codelineno-31-79" name="__codelineno-31-79"></a><span class="cm">        *</span>
</span><span id="__span-31-80"><a id="__codelineno-31-80" name="__codelineno-31-80"></a><span class="cm">        */</span>
</span><span id="__span-31-81"><a id="__codelineno-31-81" name="__codelineno-31-81"></a><span class="w">       </span><span class="p">});</span>
</span><span id="__span-31-82"><a id="__codelineno-31-82" name="__codelineno-31-82"></a><span class="w">     </span><span class="p">});</span>
</span><span id="__span-31-83"><a id="__codelineno-31-83" name="__codelineno-31-83"></a>
</span><span id="__span-31-84"><a id="__codelineno-31-84" name="__codelineno-31-84"></a><span class="w">     </span><span class="n">q</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span>
</span><span id="__span-31-85"><a id="__codelineno-31-85" name="__codelineno-31-85"></a>
</span><span id="__span-31-86"><a id="__codelineno-31-86" name="__codelineno-31-86"></a><span class="w">     </span><span class="c1">//verify that correctness</span>
</span><span id="__span-31-87"><a id="__codelineno-31-87" name="__codelineno-31-87"></a><span class="w">     </span><span class="c1">//long host_vec[N];</span>
</span><span id="__span-31-88"><a id="__codelineno-31-88" name="__codelineno-31-88"></a><span class="w">     </span><span class="c1">//q.memcpy(host_vec, device_vec, N * sizeof(long)).wait();</span>
</span><span id="__span-31-89"><a id="__codelineno-31-89" name="__codelineno-31-89"></a><span class="w">     </span><span class="c1">//for (int k = 0 ; k &lt; N ; k++){</span>
</span><span id="__span-31-90"><a id="__codelineno-31-90" name="__codelineno-31-90"></a><span class="w">     </span><span class="c1">//     std::cout &lt;&lt;&quot;FIB(&quot;&lt;&lt;k+1&lt;&lt;&quot;)=&quot; &lt;&lt; host_vec[k] &lt;&lt; std::endl;</span>
</span><span id="__span-31-91"><a id="__codelineno-31-91" name="__codelineno-31-91"></a><span class="w">     </span><span class="c1">//}</span>
</span><span id="__span-31-92"><a id="__codelineno-31-92" name="__codelineno-31-92"></a><span class="w">     </span><span class="c1">//</span>
</span><span id="__span-31-93"><a id="__codelineno-31-93" name="__codelineno-31-93"></a><span class="w">     </span><span class="c1">//if (host_vec[N-1] != fib_40) {</span>
</span><span id="__span-31-94"><a id="__codelineno-31-94" name="__codelineno-31-94"></a><span class="w">     </span><span class="c1">//  std::cout &lt;&lt; &quot;expected=&quot; &lt;&lt; fib_40 &lt;&lt; &quot;: result &quot; &lt;&lt; host_vec[N-1] &lt;&lt; std::endl;</span>
</span><span id="__span-31-95"><a id="__codelineno-31-95" name="__codelineno-31-95"></a><span class="w">     </span><span class="c1">//  passed = false;</span>
</span><span id="__span-31-96"><a id="__codelineno-31-96" name="__codelineno-31-96"></a><span class="w">     </span><span class="c1">//}</span>
</span><span id="__span-31-97"><a id="__codelineno-31-97" name="__codelineno-31-97"></a>
</span><span id="__span-31-98"><a id="__codelineno-31-98" name="__codelineno-31-98"></a>
</span><span id="__span-31-99"><a id="__codelineno-31-99" name="__codelineno-31-99"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">sycl</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-100"><a id="__codelineno-31-100" name="__codelineno-31-100"></a><span class="w">    </span><span class="c1">// Catches exceptions in the host code.</span>
</span><span id="__span-31-101"><a id="__codelineno-31-101" name="__codelineno-31-101"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Caught a SYCL host exception:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-31-102"><a id="__codelineno-31-102" name="__codelineno-31-102"></a>
</span><span id="__span-31-103"><a id="__codelineno-31-103" name="__codelineno-31-103"></a><span class="w">    </span><span class="c1">// Most likely the runtime couldn&#39;t find FPGA hardware!</span>
</span><span id="__span-31-104"><a id="__codelineno-31-104" name="__codelineno-31-104"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">().</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CL_DEVICE_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-105"><a id="__codelineno-31-105" name="__codelineno-31-105"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting an FPGA, please ensure that your &quot;</span>
</span><span id="__span-31-106"><a id="__codelineno-31-106" name="__codelineno-31-106"></a><span class="w">                   </span><span class="s">&quot;system has a correctly configured FPGA board.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-31-107"><a id="__codelineno-31-107" name="__codelineno-31-107"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Run sys_check in the oneAPI root directory to verify.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-31-108"><a id="__codelineno-31-108" name="__codelineno-31-108"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting the FPGA emulator, compile with &quot;</span>
</span><span id="__span-31-109"><a id="__codelineno-31-109" name="__codelineno-31-109"></a><span class="w">                   </span><span class="s">&quot;-DFPGA_EMULATOR.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-31-110"><a id="__codelineno-31-110" name="__codelineno-31-110"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-31-111"><a id="__codelineno-31-111" name="__codelineno-31-111"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
</span><span id="__span-31-112"><a id="__codelineno-31-112" name="__codelineno-31-112"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-31-113"><a id="__codelineno-31-113" name="__codelineno-31-113"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
</span><span id="__span-31-114"><a id="__codelineno-31-114" name="__codelineno-31-114"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<ul>
<li>To execute your code, uncomment the following lines in <code>launcher_E08-pipe.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building&quot;</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DBUILD<span class="o">=</span>EX<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>./E08-pipe.fpga_emu
</span></code></pre></div></li>
<li>To test the solution, uncomment the following lines in <code>launcher_E08-pipe.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DPASSWORD<span class="o">=</span><span class="s2">&quot;XXXXXX&quot;</span><span class="w"> </span>-DBUILD<span class="o">=</span>SOL<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>./E08-pipe.fpga_emu
</span></code></pre></div></li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>To run the fpga image, uncomment the following lines in <code>launcher_E08-pipe.sh</code></li>
<li>Make sure that the header <code>#SBATCH -p fpga</code> is present
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">JEMALLOC_PRELOAD</span><span class="o">=</span><span class="k">$(</span>jemalloc-config<span class="w"> </span>--libdir<span class="k">)</span>/libjemalloc.so.<span class="k">$(</span>jemalloc-config<span class="w"> </span>--revision<span class="k">)</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="nb">cd</span><span class="w"> </span>fpga_image
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="si">${</span><span class="nv">JEMALLOC_PRELOAD</span><span class="si">}</span><span class="w"> </span>./E08-pipe.fpga
</span></code></pre></div></li>
</ul>
</div>
</div>
</div>
</div>
<h3 id="e09-multi-device">E09-multi-device<a class="headerlink" href="#e09-multi-device" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">Multi-device computations</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:4"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><input id="__tabbed_9_3" name="__tabbed_9" type="radio" /><input id="__tabbed_9_4" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">Instruction</label><label for="__tabbed_9_2">Code description</label><label for="__tabbed_9_3">Emulation (test + solution)</label><label for="__tabbed_9_4">Hardware (Solution)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Go to <code>./exercices/E09-multi-device</code></li>
<li>You are given an host_array and needs to transfer the first half into device 1 and the second part to device 2</li>
<li>The first device will add 1 to each value of the first half while the second one will add 2 to each value of the second half </li>
<li>Finally, retrieve from the two half from each device and update the original host_array</li>
<li>Execute your code with the FPGA emulator</li>
<li>Execute the FPGA image in the <code>fpga_image</code> folder</li>
</ul>
</div>
<div class="tabbed-block">
<div class="language-cpp highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">  1</a></span>
<span class="normal"><a href="#__codelineno-35-2">  2</a></span>
<span class="normal"><a href="#__codelineno-35-3">  3</a></span>
<span class="normal"><a href="#__codelineno-35-4">  4</a></span>
<span class="normal"><a href="#__codelineno-35-5">  5</a></span>
<span class="normal"><a href="#__codelineno-35-6">  6</a></span>
<span class="normal"><a href="#__codelineno-35-7">  7</a></span>
<span class="normal"><a href="#__codelineno-35-8">  8</a></span>
<span class="normal"><a href="#__codelineno-35-9">  9</a></span>
<span class="normal"><a href="#__codelineno-35-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-35-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-35-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-35-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-35-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-35-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-35-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-35-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-35-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-35-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-35-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-35-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-35-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-35-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-35-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-35-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-35-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-35-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-35-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-35-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-35-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-35-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-35-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-35-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-35-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-35-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-35-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-35-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-35-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-35-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-35-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-35-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-35-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-35-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-35-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-35-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-35-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-35-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-35-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-35-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-35-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-35-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-35-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-35-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-35-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-35-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-35-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-35-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-35-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-35-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-35-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-35-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-35-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-35-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-35-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-35-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-35-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-35-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-35-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-35-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-35-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-35-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-35-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-35-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-35-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-35-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-35-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-35-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-35-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-35-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-35-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-35-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-35-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-35-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-35-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-35-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-35-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-35-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-35-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-35-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-35-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-35-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-35-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-35-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-35-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-35-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-35-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-35-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-35-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-35-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-35-100">100</a></span>
<span class="normal"><a href="#__codelineno-35-101">101</a></span>
<span class="normal"><a href="#__codelineno-35-102">102</a></span>
<span class="normal"><a href="#__codelineno-35-103">103</a></span>
<span class="normal"><a href="#__codelineno-35-104">104</a></span>
<span class="normal"><a href="#__codelineno-35-105">105</a></span>
<span class="normal"><a href="#__codelineno-35-106">106</a></span>
<span class="normal"><a href="#__codelineno-35-107">107</a></span>
<span class="normal"><a href="#__codelineno-35-108">108</a></span>
<span class="normal"><a href="#__codelineno-35-109">109</a></span>
<span class="normal"><a href="#__codelineno-35-110">110</a></span>
<span class="normal"><a href="#__codelineno-35-111">111</a></span>
<span class="normal"><a href="#__codelineno-35-112">112</a></span>
<span class="normal"><a href="#__codelineno-35-113">113</a></span>
<span class="normal"><a href="#__codelineno-35-114">114</a></span>
<span class="normal"><a href="#__codelineno-35-115">115</a></span>
<span class="normal"><a href="#__codelineno-35-116">116</a></span>
<span class="normal"><a href="#__codelineno-35-117">117</a></span>
<span class="normal"><a href="#__codelineno-35-118">118</a></span>
<span class="normal"><a href="#__codelineno-35-119">119</a></span>
<span class="normal"><a href="#__codelineno-35-120">120</a></span>
<span class="normal"><a href="#__codelineno-35-121">121</a></span>
<span class="normal"><a href="#__codelineno-35-122">122</a></span>
<span class="normal"><a href="#__codelineno-35-123">123</a></span>
<span class="normal"><a href="#__codelineno-35-124">124</a></span>
<span class="normal"><a href="#__codelineno-35-125">125</a></span>
<span class="normal"><a href="#__codelineno-35-126">126</a></span>
<span class="normal"><a href="#__codelineno-35-127">127</a></span>
<span class="normal"><a href="#__codelineno-35-128">128</a></span>
<span class="normal"><a href="#__codelineno-35-129">129</a></span>
<span class="normal"><a href="#__codelineno-35-130">130</a></span>
<span class="normal"><a href="#__codelineno-35-131">131</a></span>
<span class="normal"><a href="#__codelineno-35-132">132</a></span>
<span class="normal"><a href="#__codelineno-35-133">133</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2"></a>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="c1">// oneAPI headers</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/ext/intel/fpga_extensions.hpp&gt;</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/sycl.hpp&gt;</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6"></a>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7"></a>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="cp">#ifdef __SYCL_DEVICE_ONLY__</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="cp">#define CL_CONSTANT __attribute__((opencl_constant))</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="cp">#else</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="cp">#define CL_CONSTANT</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="cp">#endif</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13"></a>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">sycl</span><span class="p">;</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15"></a>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16"></a><span class="cp">#define PRINTF(format, ...)                                    \</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17"></a><span class="cp">  {                                                            \</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18"></a><span class="cp">    static const CL_CONSTANT char _format[] = format;          \</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19"></a><span class="cp">    ext::oneapi::experimental::printf(_format, ##__VA_ARGS__); \</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20"></a><span class="cp">  }</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21"></a>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22"></a><span class="k">class</span><span class="w"> </span><span class="nc">FirstDeviceID</span><span class="p">;</span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23"></a><span class="k">class</span><span class="w"> </span><span class="nc">SecondDeviceID</span><span class="p">;</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24"></a>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-35-28"><a id="__codelineno-35-28" name="__codelineno-35-28"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-29"><a id="__codelineno-35-29" name="__codelineno-35-29"></a><span class="w">    </span><span class="c1">// Use compile-time macros to select either:</span>
</span><span id="__span-35-30"><a id="__codelineno-35-30" name="__codelineno-35-30"></a><span class="w">    </span><span class="c1">//  - the FPGA emulator device (CPU emulation of the FPGA)</span>
</span><span id="__span-35-31"><a id="__codelineno-35-31" name="__codelineno-35-31"></a><span class="w">    </span><span class="c1">//  - the FPGA device (a real FPGA)</span>
</span><span id="__span-35-32"><a id="__codelineno-35-32" name="__codelineno-35-32"></a><span class="w">    </span><span class="c1">//  - the simulator device</span>
</span><span id="__span-35-33"><a id="__codelineno-35-33" name="__codelineno-35-33"></a><span class="w">      </span><span class="cp">#if FPGA_SIMULATOR</span>
</span><span id="__span-35-34"><a id="__codelineno-35-34" name="__codelineno-35-34"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_simulator_selector_v</span><span class="p">;</span>
</span><span id="__span-35-35"><a id="__codelineno-35-35" name="__codelineno-35-35"></a><span class="w">      </span><span class="cp">#elif FPGA_HARDWARE</span>
</span><span id="__span-35-36"><a id="__codelineno-35-36" name="__codelineno-35-36"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_selector_v</span><span class="p">;</span>
</span><span id="__span-35-37"><a id="__codelineno-35-37" name="__codelineno-35-37"></a><span class="w">      </span><span class="cp">#else  </span><span class="c1">// #if FPGA_EMULATOR</span>
</span><span id="__span-35-38"><a id="__codelineno-35-38" name="__codelineno-35-38"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_emulator_selector_v</span><span class="p">;</span>
</span><span id="__span-35-39"><a id="__codelineno-35-39" name="__codelineno-35-39"></a><span class="w">      </span><span class="cp">#endif</span>
</span><span id="__span-35-40"><a id="__codelineno-35-40" name="__codelineno-35-40"></a>
</span><span id="__span-35-41"><a id="__codelineno-35-41" name="__codelineno-35-41"></a>
</span><span id="__span-35-42"><a id="__codelineno-35-42" name="__codelineno-35-42"></a><span class="w">    </span><span class="cp">#if FPGA_HARDWARE</span>
</span><span id="__span-35-43"><a id="__codelineno-35-43" name="__codelineno-35-43"></a><span class="w">    </span><span class="cm">/*</span>
</span><span id="__span-35-44"><a id="__codelineno-35-44" name="__codelineno-35-44"></a><span class="cm">      *</span>
</span><span id="__span-35-45"><a id="__codelineno-35-45" name="__codelineno-35-45"></a><span class="cm">      *</span>
</span><span id="__span-35-46"><a id="__codelineno-35-46" name="__codelineno-35-46"></a><span class="cm">      * Define the context and the queue here</span>
</span><span id="__span-35-47"><a id="__codelineno-35-47" name="__codelineno-35-47"></a><span class="cm">      *</span>
</span><span id="__span-35-48"><a id="__codelineno-35-48" name="__codelineno-35-48"></a><span class="cm">      */</span>
</span><span id="__span-35-49"><a id="__codelineno-35-49" name="__codelineno-35-49"></a><span class="w">    </span><span class="cp">#else</span>
</span><span id="__span-35-50"><a id="__codelineno-35-50" name="__codelineno-35-50"></a><span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">queue</span><span class="w"> </span><span class="n">q0</span><span class="w"> </span><span class="p">(</span><span class="n">selector</span><span class="p">);</span>
</span><span id="__span-35-51"><a id="__codelineno-35-51" name="__codelineno-35-51"></a><span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">queue</span><span class="w"> </span><span class="n">q1</span><span class="w"> </span><span class="p">(</span><span class="n">selector</span><span class="p">);</span>
</span><span id="__span-35-52"><a id="__codelineno-35-52" name="__codelineno-35-52"></a><span class="w">    </span><span class="cp">#endif</span>
</span><span id="__span-35-53"><a id="__codelineno-35-53" name="__codelineno-35-53"></a>
</span><span id="__span-35-54"><a id="__codelineno-35-54" name="__codelineno-35-54"></a>
</span><span id="__span-35-55"><a id="__codelineno-35-55" name="__codelineno-35-55"></a><span class="w">    </span><span class="cm">/*</span>
</span><span id="__span-35-56"><a id="__codelineno-35-56" name="__codelineno-35-56"></a><span class="cm">      *</span>
</span><span id="__span-35-57"><a id="__codelineno-35-57" name="__codelineno-35-57"></a><span class="cm">      *</span>
</span><span id="__span-35-58"><a id="__codelineno-35-58" name="__codelineno-35-58"></a><span class="cm">      * Get the device and print their names</span>
</span><span id="__span-35-59"><a id="__codelineno-35-59" name="__codelineno-35-59"></a><span class="cm">      *</span>
</span><span id="__span-35-60"><a id="__codelineno-35-60" name="__codelineno-35-60"></a><span class="cm">      *</span>
</span><span id="__span-35-61"><a id="__codelineno-35-61" name="__codelineno-35-61"></a><span class="cm">      */</span>
</span><span id="__span-35-62"><a id="__codelineno-35-62" name="__codelineno-35-62"></a>
</span><span id="__span-35-63"><a id="__codelineno-35-63" name="__codelineno-35-63"></a>
</span><span id="__span-35-64"><a id="__codelineno-35-64" name="__codelineno-35-64"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">host_array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
</span><span id="__span-35-65"><a id="__codelineno-35-65" name="__codelineno-35-65"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">memset</span><span class="p">(</span><span class="n">host_array</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="p">);</span>
</span><span id="__span-35-66"><a id="__codelineno-35-66" name="__codelineno-35-66"></a><span class="w">    </span><span class="cm">/*</span>
</span><span id="__span-35-67"><a id="__codelineno-35-67" name="__codelineno-35-67"></a><span class="cm">      *</span>
</span><span id="__span-35-68"><a id="__codelineno-35-68" name="__codelineno-35-68"></a><span class="cm">      * Setup two array on both device global memories with size N/2</span>
</span><span id="__span-35-69"><a id="__codelineno-35-69" name="__codelineno-35-69"></a><span class="cm">      * Transfer the first half of the host array on the first device</span>
</span><span id="__span-35-70"><a id="__codelineno-35-70" name="__codelineno-35-70"></a><span class="cm">      * and the second half on the second array</span>
</span><span id="__span-35-71"><a id="__codelineno-35-71" name="__codelineno-35-71"></a><span class="cm">      */</span>
</span><span id="__span-35-72"><a id="__codelineno-35-72" name="__codelineno-35-72"></a>
</span><span id="__span-35-73"><a id="__codelineno-35-73" name="__codelineno-35-73"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Using USM device&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-35-74"><a id="__codelineno-35-74" name="__codelineno-35-74"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-35-75"><a id="__codelineno-35-75" name="__codelineno-35-75"></a>
</span><span id="__span-35-76"><a id="__codelineno-35-76" name="__codelineno-35-76"></a><span class="w">    </span><span class="n">q0</span><span class="p">.</span><span class="n">submit</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">handler</span><span class="o">&amp;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-77"><a id="__codelineno-35-77" name="__codelineno-35-77"></a><span class="w">       </span><span class="n">h</span><span class="p">.</span><span class="n">single_task</span><span class="o">&lt;</span><span class="n">FirstDeviceID</span><span class="o">&gt;</span><span class="p">([</span><span class="o">=</span><span class="p">](){</span><span class="w"> </span>
</span><span id="__span-35-78"><a id="__codelineno-35-78" name="__codelineno-35-78"></a><span class="w">          </span><span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-35-79"><a id="__codelineno-35-79" name="__codelineno-35-79"></a><span class="w">            </span><span class="n">device_part1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-35-80"><a id="__codelineno-35-80" name="__codelineno-35-80"></a><span class="w">       </span><span class="p">});</span>
</span><span id="__span-35-81"><a id="__codelineno-35-81" name="__codelineno-35-81"></a><span class="w">     </span><span class="p">});</span>
</span><span id="__span-35-82"><a id="__codelineno-35-82" name="__codelineno-35-82"></a>
</span><span id="__span-35-83"><a id="__codelineno-35-83" name="__codelineno-35-83"></a><span class="w">   </span><span class="n">q1</span><span class="p">.</span><span class="n">submit</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">handler</span><span class="o">&amp;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-84"><a id="__codelineno-35-84" name="__codelineno-35-84"></a><span class="w">       </span><span class="n">h</span><span class="p">.</span><span class="n">single_task</span><span class="o">&lt;</span><span class="n">SecondDeviceID</span><span class="o">&gt;</span><span class="p">([</span><span class="o">=</span><span class="p">](){</span><span class="w"> </span>
</span><span id="__span-35-85"><a id="__codelineno-35-85" name="__codelineno-35-85"></a><span class="w">          </span><span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-35-86"><a id="__codelineno-35-86" name="__codelineno-35-86"></a><span class="w">            </span><span class="n">device_part2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+=</span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-35-87"><a id="__codelineno-35-87" name="__codelineno-35-87"></a><span class="w">       </span><span class="p">});</span>
</span><span id="__span-35-88"><a id="__codelineno-35-88" name="__codelineno-35-88"></a><span class="w">     </span><span class="p">});</span>
</span><span id="__span-35-89"><a id="__codelineno-35-89" name="__codelineno-35-89"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-35-90"><a id="__codelineno-35-90" name="__codelineno-35-90"></a>
</span><span id="__span-35-91"><a id="__codelineno-35-91" name="__codelineno-35-91"></a><span class="w">    </span><span class="n">q0</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span>
</span><span id="__span-35-92"><a id="__codelineno-35-92" name="__codelineno-35-92"></a><span class="w">    </span><span class="n">q1</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span>
</span><span id="__span-35-93"><a id="__codelineno-35-93" name="__codelineno-35-93"></a>
</span><span id="__span-35-94"><a id="__codelineno-35-94" name="__codelineno-35-94"></a><span class="w">    </span><span class="cm">/*</span>
</span><span id="__span-35-95"><a id="__codelineno-35-95" name="__codelineno-35-95"></a><span class="cm">      *</span>
</span><span id="__span-35-96"><a id="__codelineno-35-96" name="__codelineno-35-96"></a><span class="cm">      * Retireve the two half and update the host array</span>
</span><span id="__span-35-97"><a id="__codelineno-35-97" name="__codelineno-35-97"></a><span class="cm">      *</span>
</span><span id="__span-35-98"><a id="__codelineno-35-98" name="__codelineno-35-98"></a><span class="cm">      */</span>
</span><span id="__span-35-99"><a id="__codelineno-35-99" name="__codelineno-35-99"></a>
</span><span id="__span-35-100"><a id="__codelineno-35-100" name="__codelineno-35-100"></a><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-35-101"><a id="__codelineno-35-101" name="__codelineno-35-101"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">&lt;</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">host_array</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">!=</span><span class="mi">1</span><span class="p">){</span>
</span><span id="__span-35-102"><a id="__codelineno-35-102" name="__codelineno-35-102"></a><span class="w">          </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;Expected host_array=1 but received host_array=&quot;</span><span class="o">&lt;&lt;</span><span class="n">host_array</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-35-103"><a id="__codelineno-35-103" name="__codelineno-35-103"></a><span class="w">          </span><span class="n">passed</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-35-104"><a id="__codelineno-35-104" name="__codelineno-35-104"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-35-105"><a id="__codelineno-35-105" name="__codelineno-35-105"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-35-106"><a id="__codelineno-35-106" name="__codelineno-35-106"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">&gt;=</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">host_array</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">!=</span><span class="mi">2</span><span class="p">){</span>
</span><span id="__span-35-107"><a id="__codelineno-35-107" name="__codelineno-35-107"></a><span class="w">          </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;Expected host_array=2 but received host_array=&quot;</span><span class="o">&lt;&lt;</span><span class="n">host_array</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-35-108"><a id="__codelineno-35-108" name="__codelineno-35-108"></a><span class="w">          </span><span class="n">passed</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-35-109"><a id="__codelineno-35-109" name="__codelineno-35-109"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-35-110"><a id="__codelineno-35-110" name="__codelineno-35-110"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-35-111"><a id="__codelineno-35-111" name="__codelineno-35-111"></a><span class="w">     </span><span class="p">}</span>
</span><span id="__span-35-112"><a id="__codelineno-35-112" name="__codelineno-35-112"></a>
</span><span id="__span-35-113"><a id="__codelineno-35-113" name="__codelineno-35-113"></a><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">host_array</span><span class="p">;</span>
</span><span id="__span-35-114"><a id="__codelineno-35-114" name="__codelineno-35-114"></a><span class="w">    </span><span class="cm">/*</span>
</span><span id="__span-35-115"><a id="__codelineno-35-115" name="__codelineno-35-115"></a><span class="cm">    * release memory on devices</span>
</span><span id="__span-35-116"><a id="__codelineno-35-116" name="__codelineno-35-116"></a><span class="cm">    */</span>
</span><span id="__span-35-117"><a id="__codelineno-35-117" name="__codelineno-35-117"></a>
</span><span id="__span-35-118"><a id="__codelineno-35-118" name="__codelineno-35-118"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">sycl</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-119"><a id="__codelineno-35-119" name="__codelineno-35-119"></a><span class="w">    </span><span class="c1">// Catches exceptions in the host code.</span>
</span><span id="__span-35-120"><a id="__codelineno-35-120" name="__codelineno-35-120"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Caught a SYCL host exception:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-35-121"><a id="__codelineno-35-121" name="__codelineno-35-121"></a>
</span><span id="__span-35-122"><a id="__codelineno-35-122" name="__codelineno-35-122"></a><span class="w">    </span><span class="c1">// Most likely the runtime couldn&#39;t find FPGA hardware!</span>
</span><span id="__span-35-123"><a id="__codelineno-35-123" name="__codelineno-35-123"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">().</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CL_DEVICE_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-124"><a id="__codelineno-35-124" name="__codelineno-35-124"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting an FPGA, please ensure that your &quot;</span>
</span><span id="__span-35-125"><a id="__codelineno-35-125" name="__codelineno-35-125"></a><span class="w">                   </span><span class="s">&quot;system has a correctly configured FPGA board.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-35-126"><a id="__codelineno-35-126" name="__codelineno-35-126"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Run sys_check in the oneAPI root directory to verify.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-35-127"><a id="__codelineno-35-127" name="__codelineno-35-127"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting the FPGA emulator, compile with &quot;</span>
</span><span id="__span-35-128"><a id="__codelineno-35-128" name="__codelineno-35-128"></a><span class="w">                   </span><span class="s">&quot;-DFPGA_EMULATOR.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-35-129"><a id="__codelineno-35-129" name="__codelineno-35-129"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-35-130"><a id="__codelineno-35-130" name="__codelineno-35-130"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
</span><span id="__span-35-131"><a id="__codelineno-35-131" name="__codelineno-35-131"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-35-132"><a id="__codelineno-35-132" name="__codelineno-35-132"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
</span><span id="__span-35-133"><a id="__codelineno-35-133" name="__codelineno-35-133"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<ul>
<li>To execute your code, uncomment the following lines in <code>launcher_E09-multi-device.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building&quot;</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DBUILD<span class="o">=</span>EX<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>./E09-multi-device.fpga_emu
</span></code></pre></div></li>
<li>To test the solution, uncomment the following lines in <code>launcher_E09-multi-device.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DPASSWORD<span class="o">=</span><span class="s2">&quot;XXXXXX&quot;</span><span class="w"> </span>-DBUILD<span class="o">=</span>SOL<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>./E09-multi-device.fpga_emu
</span></code></pre></div></li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>To run the fpga image, uncomment the following lines in <code>launcher_E09-multi-device.sh</code></li>
<li>Make sure that the header <code>#SBATCH -p fpga</code> is present
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">JEMALLOC_PRELOAD</span><span class="o">=</span><span class="k">$(</span>jemalloc-config<span class="w"> </span>--libdir<span class="k">)</span>/libjemalloc.so.<span class="k">$(</span>jemalloc-config<span class="w"> </span>--revision<span class="k">)</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="nb">cd</span><span class="w"> </span>fpga_image
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="si">${</span><span class="nv">JEMALLOC_PRELOAD</span><span class="si">}</span><span class="w"> </span>./E09-multi-device.fpga
</span></code></pre></div></li>
</ul>
</div>
</div>
</div>
</div>
<h3 id="e10-convolution">E10-convolution<a class="headerlink" href="#e10-convolution" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">Convolution</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:4"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><input id="__tabbed_10_3" name="__tabbed_10" type="radio" /><input id="__tabbed_10_4" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">Instruction</label><label for="__tabbed_10_2">Code description</label><label for="__tabbed_10_3">Emulation (test + solution)</label><label for="__tabbed_10_4">Hardware (Solution)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Go to <code>./exercices/E10-convolution</code></li>
<li>Create a ndrange sycl kernel to apply a convolution kernel on a png image</li>
</ul>
<p><img alt="" src="../images/convolution.png" width="80%" /></p>
<ul>
<li>Execute your code with the FPGA emulator</li>
<li>Execute the FPGA image in the <code>fpga_image</code> folder</li>
</ul>
</div>
<div class="tabbed-block">
<div class="language-cpp highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">  1</a></span>
<span class="normal"><a href="#__codelineno-39-2">  2</a></span>
<span class="normal"><a href="#__codelineno-39-3">  3</a></span>
<span class="normal"><a href="#__codelineno-39-4">  4</a></span>
<span class="normal"><a href="#__codelineno-39-5">  5</a></span>
<span class="normal"><a href="#__codelineno-39-6">  6</a></span>
<span class="normal"><a href="#__codelineno-39-7">  7</a></span>
<span class="normal"><a href="#__codelineno-39-8">  8</a></span>
<span class="normal"><a href="#__codelineno-39-9">  9</a></span>
<span class="normal"><a href="#__codelineno-39-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-39-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-39-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-39-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-39-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-39-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-39-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-39-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-39-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-39-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-39-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-39-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-39-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-39-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-39-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-39-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-39-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-39-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-39-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-39-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-39-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-39-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-39-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-39-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-39-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-39-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-39-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-39-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-39-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-39-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-39-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-39-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-39-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-39-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-39-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-39-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-39-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-39-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-39-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-39-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-39-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-39-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-39-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-39-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-39-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-39-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-39-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-39-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-39-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-39-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-39-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-39-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-39-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-39-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-39-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-39-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-39-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-39-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-39-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-39-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-39-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-39-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-39-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-39-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-39-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-39-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-39-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-39-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-39-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-39-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-39-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-39-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-39-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-39-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-39-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-39-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-39-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-39-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-39-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-39-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-39-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-39-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-39-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-39-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-39-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-39-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-39-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-39-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-39-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-39-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-39-100">100</a></span>
<span class="normal"><a href="#__codelineno-39-101">101</a></span>
<span class="normal"><a href="#__codelineno-39-102">102</a></span>
<span class="normal"><a href="#__codelineno-39-103">103</a></span>
<span class="normal"><a href="#__codelineno-39-104">104</a></span>
<span class="normal"><a href="#__codelineno-39-105">105</a></span>
<span class="normal"><a href="#__codelineno-39-106">106</a></span>
<span class="normal"><a href="#__codelineno-39-107">107</a></span>
<span class="normal"><a href="#__codelineno-39-108">108</a></span>
<span class="normal"><a href="#__codelineno-39-109">109</a></span>
<span class="normal"><a href="#__codelineno-39-110">110</a></span>
<span class="normal"><a href="#__codelineno-39-111">111</a></span>
<span class="normal"><a href="#__codelineno-39-112">112</a></span>
<span class="normal"><a href="#__codelineno-39-113">113</a></span>
<span class="normal"><a href="#__codelineno-39-114">114</a></span>
<span class="normal"><a href="#__codelineno-39-115">115</a></span>
<span class="normal"><a href="#__codelineno-39-116">116</a></span>
<span class="normal"><a href="#__codelineno-39-117">117</a></span>
<span class="normal"><a href="#__codelineno-39-118">118</a></span>
<span class="normal"><a href="#__codelineno-39-119">119</a></span>
<span class="normal"><a href="#__codelineno-39-120">120</a></span>
<span class="normal"><a href="#__codelineno-39-121">121</a></span>
<span class="normal"><a href="#__codelineno-39-122">122</a></span>
<span class="normal"><a href="#__codelineno-39-123">123</a></span>
<span class="normal"><a href="#__codelineno-39-124">124</a></span>
<span class="normal"><a href="#__codelineno-39-125">125</a></span>
<span class="normal"><a href="#__codelineno-39-126">126</a></span>
<span class="normal"><a href="#__codelineno-39-127">127</a></span>
<span class="normal"><a href="#__codelineno-39-128">128</a></span>
<span class="normal"><a href="#__codelineno-39-129">129</a></span>
<span class="normal"><a href="#__codelineno-39-130">130</a></span>
<span class="normal"><a href="#__codelineno-39-131">131</a></span>
<span class="normal"><a href="#__codelineno-39-132">132</a></span>
<span class="normal"><a href="#__codelineno-39-133">133</a></span>
<span class="normal"><a href="#__codelineno-39-134">134</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;opencv2/opencv.hpp&gt;</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4"></a>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="c1">// oneAPI headers</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/ext/intel/fpga_extensions.hpp&gt;</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sycl/sycl.hpp&gt;</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8"></a>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9"></a>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10"></a><span class="cp">#ifdef __SYCL_DEVICE_ONLY__</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11"></a><span class="cp">#define CL_CONSTANT __attribute__((opencl_constant))</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12"></a><span class="cp">#else</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13"></a><span class="cp">#define CL_CONSTANT</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14"></a><span class="cp">#endif</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15"></a>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16"></a><span class="cp">#define pi 3.14159265359</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17"></a><span class="cp">#define KERNEL_SIZE 3</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18"></a>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19"></a><span class="k">class</span><span class="w"> </span><span class="nc">ConvolutionID</span><span class="p">;</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20"></a>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">sycl</span><span class="p">;</span>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22"></a>
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23"></a><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="nf">load_image</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">im_path</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">Nx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">Ny</span><span class="p">){</span>
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24"></a><span class="w">       </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">imread</span><span class="p">(</span><span class="n">im_path</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">);</span>
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25"></a>
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26"></a><span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-27"><a id="__codelineno-39-27" name="__codelineno-39-27"></a><span class="w">           </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to load image!&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-39-28"><a id="__codelineno-39-28" name="__codelineno-39-28"></a><span class="w">           </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span id="__span-39-29"><a id="__codelineno-39-29" name="__codelineno-39-29"></a><span class="w">       </span><span class="p">}</span>
</span><span id="__span-39-30"><a id="__codelineno-39-30" name="__codelineno-39-30"></a>
</span><span id="__span-39-31"><a id="__codelineno-39-31" name="__codelineno-39-31"></a><span class="w">       </span><span class="c1">// Convert to float (optional: normalize to [0,1])</span>
</span><span id="__span-39-32"><a id="__codelineno-39-32" name="__codelineno-39-32"></a><span class="w">       </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">imageFloat</span><span class="p">;</span>
</span><span id="__span-39-33"><a id="__codelineno-39-33" name="__codelineno-39-33"></a><span class="w">       </span><span class="n">image</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">imageFloat</span><span class="p">,</span><span class="w"> </span><span class="n">CV_32F</span><span class="p">);</span><span class="w"> </span><span class="c1">// normalize to 0-1 range</span>
</span><span id="__span-39-34"><a id="__codelineno-39-34" name="__codelineno-39-34"></a>
</span><span id="__span-39-35"><a id="__codelineno-39-35" name="__codelineno-39-35"></a><span class="w">       </span><span class="c1">// Allocate and copy to float*</span>
</span><span id="__span-39-36"><a id="__codelineno-39-36" name="__codelineno-39-36"></a><span class="w">       </span><span class="o">*</span><span class="n">Nx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageFloat</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span>
</span><span id="__span-39-37"><a id="__codelineno-39-37" name="__codelineno-39-37"></a><span class="w">       </span><span class="o">*</span><span class="n">Ny</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageFloat</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span>
</span><span id="__span-39-38"><a id="__codelineno-39-38" name="__codelineno-39-38"></a><span class="w">       </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageFloat</span><span class="p">.</span><span class="n">rows</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">imageFloat</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span>
</span><span id="__span-39-39"><a id="__codelineno-39-39" name="__codelineno-39-39"></a><span class="w">       </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">float</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>
</span><span id="__span-39-40"><a id="__codelineno-39-40" name="__codelineno-39-40"></a><span class="w">       </span><span class="n">std</span><span class="o">::</span><span class="n">memcpy</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">imageFloat</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
</span><span id="__span-39-41"><a id="__codelineno-39-41" name="__codelineno-39-41"></a>
</span><span id="__span-39-42"><a id="__codelineno-39-42" name="__codelineno-39-42"></a><span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
</span><span id="__span-39-43"><a id="__codelineno-39-43" name="__codelineno-39-43"></a><span class="p">}</span>
</span><span id="__span-39-44"><a id="__codelineno-39-44" name="__codelineno-39-44"></a>
</span><span id="__span-39-45"><a id="__codelineno-39-45" name="__codelineno-39-45"></a><span class="kt">void</span><span class="w"> </span><span class="nf">save_image</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">im_path</span><span class="p">,</span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Nx</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Ny</span><span class="p">){</span>
</span><span id="__span-39-46"><a id="__codelineno-39-46" name="__codelineno-39-46"></a>
</span><span id="__span-39-47"><a id="__codelineno-39-47" name="__codelineno-39-47"></a><span class="w">        </span><span class="c1">// Create a CV_32F Mat from the buffer (no copy, wraps memory)</span>
</span><span id="__span-39-48"><a id="__codelineno-39-48" name="__codelineno-39-48"></a><span class="w">        </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">floatImage</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span><span class="w"> </span><span class="n">Ny</span><span class="p">,</span><span class="w"> </span><span class="n">CV_32F</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">);</span>
</span><span id="__span-39-49"><a id="__codelineno-39-49" name="__codelineno-39-49"></a>
</span><span id="__span-39-50"><a id="__codelineno-39-50" name="__codelineno-39-50"></a><span class="w">        </span><span class="c1">// Convert to 8-bit grayscale for saving or displaying</span>
</span><span id="__span-39-51"><a id="__codelineno-39-51" name="__codelineno-39-51"></a><span class="w">        </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">grayImage</span><span class="p">;</span>
</span><span id="__span-39-52"><a id="__codelineno-39-52" name="__codelineno-39-52"></a><span class="w">        </span><span class="n">floatImage</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">grayImage</span><span class="p">,</span><span class="w"> </span><span class="n">CV_8U</span><span class="p">);</span><span class="w"> </span><span class="c1">// scale from [0,1] â [0,255]</span>
</span><span id="__span-39-53"><a id="__codelineno-39-53" name="__codelineno-39-53"></a>
</span><span id="__span-39-54"><a id="__codelineno-39-54" name="__codelineno-39-54"></a><span class="w">        </span><span class="c1">// Save or display</span>
</span><span id="__span-39-55"><a id="__codelineno-39-55" name="__codelineno-39-55"></a><span class="w">        </span><span class="n">cv</span><span class="o">::</span><span class="n">imwrite</span><span class="p">(</span><span class="n">im_path</span><span class="p">,</span><span class="w"> </span><span class="n">grayImage</span><span class="p">);</span>
</span><span id="__span-39-56"><a id="__codelineno-39-56" name="__codelineno-39-56"></a><span class="p">}</span>
</span><span id="__span-39-57"><a id="__codelineno-39-57" name="__codelineno-39-57"></a>
</span><span id="__span-39-58"><a id="__codelineno-39-58" name="__codelineno-39-58"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-59"><a id="__codelineno-39-59" name="__codelineno-39-59"></a>
</span><span id="__span-39-60"><a id="__codelineno-39-60" name="__codelineno-39-60"></a><span class="w">  </span><span class="c1">// Check if exactly one argument is passed (excluding program name)</span>
</span><span id="__span-39-61"><a id="__codelineno-39-61" name="__codelineno-39-61"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-62"><a id="__codelineno-39-62" name="__codelineno-39-62"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Usage: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &lt;filename&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-39-63"><a id="__codelineno-39-63" name="__codelineno-39-63"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-39-64"><a id="__codelineno-39-64" name="__codelineno-39-64"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-39-65"><a id="__codelineno-39-65" name="__codelineno-39-65"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span id="__span-39-66"><a id="__codelineno-39-66" name="__codelineno-39-66"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</span><span id="__span-39-67"><a id="__codelineno-39-67" name="__codelineno-39-67"></a>
</span><span id="__span-39-68"><a id="__codelineno-39-68" name="__codelineno-39-68"></a><span class="w">  </span><span class="c1">// Check if the file can be opened</span>
</span><span id="__span-39-69"><a id="__codelineno-39-69" name="__codelineno-39-69"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-70"><a id="__codelineno-39-70" name="__codelineno-39-70"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error: &#39;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&#39; is not a valid file.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-39-71"><a id="__codelineno-39-71" name="__codelineno-39-71"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
</span><span id="__span-39-72"><a id="__codelineno-39-72" name="__codelineno-39-72"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-39-73"><a id="__codelineno-39-73" name="__codelineno-39-73"></a>
</span><span id="__span-39-74"><a id="__codelineno-39-74" name="__codelineno-39-74"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">Nx</span><span class="p">;</span>
</span><span id="__span-39-75"><a id="__codelineno-39-75" name="__codelineno-39-75"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">Ny</span><span class="p">;</span>
</span><span id="__span-39-76"><a id="__codelineno-39-76" name="__codelineno-39-76"></a><span class="w">  </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load_image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="o">&amp;</span><span class="n">Nx</span><span class="p">,</span><span class="o">&amp;</span><span class="n">Ny</span><span class="p">);</span>
</span><span id="__span-39-77"><a id="__codelineno-39-77" name="__codelineno-39-77"></a><span class="w">  </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">bufferf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="o">*</span><span class="n">Nx</span><span class="o">*</span><span class="n">Ny</span><span class="p">);</span>
</span><span id="__span-39-78"><a id="__codelineno-39-78" name="__codelineno-39-78"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;The image has &quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Nx</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot; rows and &quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Ny</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot; cols&quot;</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-39-79"><a id="__codelineno-39-79" name="__codelineno-39-79"></a>
</span><span id="__span-39-80"><a id="__codelineno-39-80" name="__codelineno-39-80"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">kernel</span><span class="p">[(</span><span class="n">KERNEL_SIZE</span><span class="o">*</span><span class="n">KERNEL_SIZE</span><span class="p">)]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-39-81"><a id="__codelineno-39-81" name="__codelineno-39-81"></a><span class="w">                                           </span><span class="mi">1</span><span class="p">,</span><span class="mi">-4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-39-82"><a id="__codelineno-39-82" name="__codelineno-39-82"></a><span class="w">                                           </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-39-83"><a id="__codelineno-39-83" name="__codelineno-39-83"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-39-84"><a id="__codelineno-39-84" name="__codelineno-39-84"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-85"><a id="__codelineno-39-85" name="__codelineno-39-85"></a><span class="w">    </span><span class="c1">// Use compile-time macros to select either:</span>
</span><span id="__span-39-86"><a id="__codelineno-39-86" name="__codelineno-39-86"></a><span class="w">    </span><span class="c1">//  - the FPGA emulator device (CPU emulation of the FPGA)</span>
</span><span id="__span-39-87"><a id="__codelineno-39-87" name="__codelineno-39-87"></a><span class="w">    </span><span class="c1">//  - the FPGA device (a real FPGA)</span>
</span><span id="__span-39-88"><a id="__codelineno-39-88" name="__codelineno-39-88"></a><span class="w">    </span><span class="c1">//  - the simulator device</span>
</span><span id="__span-39-89"><a id="__codelineno-39-89" name="__codelineno-39-89"></a><span class="w">      </span><span class="cp">#if FPGA_SIMULATOR</span>
</span><span id="__span-39-90"><a id="__codelineno-39-90" name="__codelineno-39-90"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_simulator_selector_v</span><span class="p">;</span>
</span><span id="__span-39-91"><a id="__codelineno-39-91" name="__codelineno-39-91"></a><span class="w">      </span><span class="cp">#elif FPGA_HARDWARE</span>
</span><span id="__span-39-92"><a id="__codelineno-39-92" name="__codelineno-39-92"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_selector_v</span><span class="p">;</span>
</span><span id="__span-39-93"><a id="__codelineno-39-93" name="__codelineno-39-93"></a><span class="w">      </span><span class="cp">#else  </span><span class="c1">// #if FPGA_EMULATOR</span>
</span><span id="__span-39-94"><a id="__codelineno-39-94" name="__codelineno-39-94"></a><span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sycl</span><span class="o">::</span><span class="n">ext</span><span class="o">::</span><span class="n">intel</span><span class="o">::</span><span class="n">fpga_emulator_selector_v</span><span class="p">;</span>
</span><span id="__span-39-95"><a id="__codelineno-39-95" name="__codelineno-39-95"></a><span class="w">      </span><span class="cp">#endif</span>
</span><span id="__span-39-96"><a id="__codelineno-39-96" name="__codelineno-39-96"></a>
</span><span id="__span-39-97"><a id="__codelineno-39-97" name="__codelineno-39-97"></a><span class="w">    </span><span class="n">sycl</span><span class="o">::</span><span class="n">queue</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="p">(</span><span class="n">selector</span><span class="p">);</span>
</span><span id="__span-39-98"><a id="__codelineno-39-98" name="__codelineno-39-98"></a>
</span><span id="__span-39-99"><a id="__codelineno-39-99" name="__codelineno-39-99"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queue</span><span class="p">.</span><span class="n">get_device</span><span class="p">();</span>
</span><span id="__span-39-100"><a id="__codelineno-39-100" name="__codelineno-39-100"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Running on device: &quot;</span>
</span><span id="__span-39-101"><a id="__codelineno-39-101" name="__codelineno-39-101"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">device</span><span class="p">.</span><span class="n">get_info</span><span class="o">&lt;</span><span class="n">sycl</span><span class="o">::</span><span class="n">info</span><span class="o">::</span><span class="n">device</span><span class="o">::</span><span class="n">name</span><span class="o">&gt;</span><span class="p">().</span><span class="n">c_str</span><span class="p">()</span>
</span><span id="__span-39-102"><a id="__codelineno-39-102" name="__codelineno-39-102"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-39-103"><a id="__codelineno-39-103" name="__codelineno-39-103"></a>
</span><span id="__span-39-104"><a id="__codelineno-39-104" name="__codelineno-39-104"></a><span class="w">    </span><span class="cm">/*</span>
</span><span id="__span-39-105"><a id="__codelineno-39-105" name="__codelineno-39-105"></a><span class="cm">     *  1. Create buffers </span>
</span><span id="__span-39-106"><a id="__codelineno-39-106" name="__codelineno-39-106"></a><span class="cm">     *  2. Create the kernel and call it using the queue</span>
</span><span id="__span-39-107"><a id="__codelineno-39-107" name="__codelineno-39-107"></a><span class="cm">     *  Hint: Try to use some the optimization seen in the course</span>
</span><span id="__span-39-108"><a id="__codelineno-39-108" name="__codelineno-39-108"></a><span class="cm">     */</span>
</span><span id="__span-39-109"><a id="__codelineno-39-109" name="__codelineno-39-109"></a>
</span><span id="__span-39-110"><a id="__codelineno-39-110" name="__codelineno-39-110"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; Saving image  &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-39-111"><a id="__codelineno-39-111" name="__codelineno-39-111"></a><span class="w">  </span><span class="n">save_image</span><span class="p">(</span><span class="s">&quot;output.png&quot;</span><span class="p">,</span><span class="n">bufferf</span><span class="p">,</span><span class="n">Nx</span><span class="p">,</span><span class="n">Ny</span><span class="p">);</span>
</span><span id="__span-39-112"><a id="__codelineno-39-112" name="__codelineno-39-112"></a><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
</span><span id="__span-39-113"><a id="__codelineno-39-113" name="__codelineno-39-113"></a><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">bufferf</span><span class="p">);</span>
</span><span id="__span-39-114"><a id="__codelineno-39-114" name="__codelineno-39-114"></a>
</span><span id="__span-39-115"><a id="__codelineno-39-115" name="__codelineno-39-115"></a>
</span><span id="__span-39-116"><a id="__codelineno-39-116" name="__codelineno-39-116"></a>
</span><span id="__span-39-117"><a id="__codelineno-39-117" name="__codelineno-39-117"></a>
</span><span id="__span-39-118"><a id="__codelineno-39-118" name="__codelineno-39-118"></a>
</span><span id="__span-39-119"><a id="__codelineno-39-119" name="__codelineno-39-119"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">sycl</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-120"><a id="__codelineno-39-120" name="__codelineno-39-120"></a><span class="w">    </span><span class="c1">// Catches exceptions in the host code.</span>
</span><span id="__span-39-121"><a id="__codelineno-39-121" name="__codelineno-39-121"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Caught a SYCL host exception:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-39-122"><a id="__codelineno-39-122" name="__codelineno-39-122"></a>
</span><span id="__span-39-123"><a id="__codelineno-39-123" name="__codelineno-39-123"></a><span class="w">    </span><span class="c1">// Most likely the runtime couldn&#39;t find FPGA hardware!</span>
</span><span id="__span-39-124"><a id="__codelineno-39-124" name="__codelineno-39-124"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">().</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CL_DEVICE_NOT_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-125"><a id="__codelineno-39-125" name="__codelineno-39-125"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting an FPGA, please ensure that your &quot;</span>
</span><span id="__span-39-126"><a id="__codelineno-39-126" name="__codelineno-39-126"></a><span class="w">                   </span><span class="s">&quot;system has a correctly configured FPGA board.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-39-127"><a id="__codelineno-39-127" name="__codelineno-39-127"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Run sys_check in the oneAPI root directory to verify.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-39-128"><a id="__codelineno-39-128" name="__codelineno-39-128"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;If you are targeting the FPGA emulator, compile with &quot;</span>
</span><span id="__span-39-129"><a id="__codelineno-39-129" name="__codelineno-39-129"></a><span class="w">                   </span><span class="s">&quot;-DFPGA_EMULATOR.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-39-130"><a id="__codelineno-39-130" name="__codelineno-39-130"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-39-131"><a id="__codelineno-39-131" name="__codelineno-39-131"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
</span><span id="__span-39-132"><a id="__codelineno-39-132" name="__codelineno-39-132"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-39-133"><a id="__codelineno-39-133" name="__codelineno-39-133"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
</span><span id="__span-39-134"><a id="__codelineno-39-134" name="__codelineno-39-134"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<ul>
<li>To execute your code, uncomment the following lines in <code>launcher_E10-convolution.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building&quot;</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DBUILD<span class="o">=</span>EX<span class="w"> </span>-DUSER_FLAGS<span class="o">=</span><span class="s2">&quot;-lopencv_core -lopencv_imgcodecs -lopencv_highgui -lopencv_imgproc&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>./E10-convolution.fpga_emu
</span></code></pre></div></li>
<li>To test the solution, uncomment the following lines in <code>launcher_E10-convolution.sh</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Create building directory&quot;</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>build<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-delete<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DPASSWORD<span class="o">=</span><span class="s2">&quot;XXXXXX&quot;</span><span class="w"> </span>-DBUILD<span class="o">=</span>SOL<span class="w"> </span>-DUSER_FLAGS<span class="o">=</span><span class="s2">&quot;-lopencv_core -lopencv_imgcodecs -lopencv_highgui -lopencv_imgproc&quot;</span><span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>fpga_emu
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>./E10-convolution.fpga_emu
</span></code></pre></div></li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>To run the fpga image, uncomment the following lines in <code>launcher_E10-convolution.sh</code></li>
<li>Make sure that the header <code>#SBATCH -p fpga</code> is present
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">JEMALLOC_PRELOAD</span><span class="o">=</span><span class="k">$(</span>jemalloc-config<span class="w"> </span>--libdir<span class="k">)</span>/libjemalloc.so.<span class="k">$(</span>jemalloc-config<span class="w"> </span>--revision<span class="k">)</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="nb">cd</span><span class="w"> </span>fpga_image
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="si">${</span><span class="nv">JEMALLOC_PRELOAD</span><span class="si">}</span><span class="w"> </span>./E10-convolution.fpga
</span></code></pre></div></li>
</ul>
</div>
</div>
</div>
</div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">June 4, 2025</span>
  </span>

    
    
    
    
  </aside>





                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 LuxProvide
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "content.code.copy", "content.code.select"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
        <script src="../javascripts/extra.js"></script>
      
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      
        <script src="../javascripts/bootstrap.min.js"></script>
      
        <script src="../javascripts/katex.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>